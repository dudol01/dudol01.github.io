<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œë´‡ì˜ ê³¼ì¼ ë¶„ë¥˜ ëŒ€ì‘ì „ (í†µí•©ë³¸)</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* --- CSS ìŠ¤íƒ€ì¼ ì‹œì‘ --- */
        body {
            font-family: 'Jua', sans-serif;
            background-color: #E0F7FA;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            user-select: none;
        }

        .game-container {
            background-color: #FFFFFF;
            width: 90%;
            max-width: 700px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            padding: 25px;
            text-align: center;
        }

        h1 { color: #FF6F61; margin: 0 0 15px 0; }

        .scoreboard {
            background-color: #FFF9C4;
            padding: 10px;
            border-radius: 10px;
            font-size: 1.2rem;
            color: #F57F17;
            font-weight: bold;
        }

        /* ë¡œë´‡ ì˜ì—­ */
        .robot-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background-color: #E1F5FE;
            border-radius: 15px;
        }

        #robot-face { width: 100px; height: 100px; object-fit: contain; }

        .speech-bubble {
            background: #fff;
            padding: 10px 15px;
            border-radius: 15px;
            border: 2px solid #4FC3F7;
            position: relative;
            font-size: 1.1rem;
        }

        /* ê³¼ì¼ ìŠ¤íƒ€ì¼ */
        .fruit { width: 70px; height: 70px; border-radius: 50%; border: 3px solid #555; transition: all 0.3s; }
        .fruit.apple { background-color: #FF5252; box-shadow: 0 0 10px #FF5252; }
        .fruit.banana { 
            background-color: #FFD740; 
            width: 90px; height: 45px; 
            border-radius: 10px; 
            transform: rotate(-10deg);
        }
        .fruit.orange { background-color: #FF9800; border-radius: 50%; }

        /* ìƒê° íŒŒì´í”„ */
        .brain-pipes {
            background-color: #FBE9E7;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px dashed #FFAB91;
        }

        .pipe-system {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            align-items: flex-end;
            height: 120px;
        }

        .pipe-line-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 45%;
        }

        input[type=range] { width: 80%; cursor: pointer; margin-bottom: 10px; z-index: 10;}

        /* ì‹œê°ì  íŒŒì´í”„ */
        .visual-pipe {
            width: 10px; height: 0px;
            transition: all 0.2s ease-out;
            border-radius: 5px;
            min-height: 5px;
        }

        .red-pipe-visual { background-color: #FF5252; box-shadow: 0 0 5px #FF5252; }
        .yellow-pipe-visual { background-color: #FFD740; box-shadow: 0 0 5px #FFD740; }

        #btn-check {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 12px 40px;
            font-size: 1.3rem;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Jua', sans-serif;
            box-shadow: 0 4px 0 #388E3C;
            transition: transform 0.1s;
        }
        #btn-check:active { transform: translateY(4px); box-shadow: none; }
        #btn-check:disabled { background-color: #ccc; box-shadow: none; cursor: not-allowed; }

        /* ë°”êµ¬ë‹ˆ ì˜ì—­ */
        .output-baskets { display: flex; gap: 10px; }
        .basket {
            flex: 1;
            padding: 15px 5px;
            background-color: #f5f5f5;
            border: 3px solid #cfcfcf;
            border-radius: 10px;
            transition: all 0.3s;
            opacity: 0.7;
        }
        .basket-icon { font-size: 2rem; margin-bottom: 5px; }
        .basket.active { 
            opacity: 1; border-color: #2196F3; background-color: #E3F2FD; 
            transform: scale(1.1); box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        .basket.locked { background-color: #e0e0e0; color: #999; border-style: dashed;}

        /* ëª¨ë‹¬ */
        .hidden { display: none !important; }
        #feedback-modal {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white; padding: 30px;
            width: 80%; max-width: 400px;
            border-radius: 20px; border: 5px solid #4CAF50;
            box-shadow: 0 0 100px rgba(0,0,0,0.5);
            z-index: 100;
            animation: popIn 0.3s;
        }
        #feedback-modal.wrong { border-color: #FF5252; }
        @keyframes popIn { from { transform: translate(-50%, -60%) scale(0.8); opacity: 0;} to { transform: translate(-50%, -50%) scale(1); opacity: 1;} }

        #btn-next {
            padding: 10px 25px; font-size: 1.1rem;
            background: #2196F3; color: white; border:none; border-radius: 5px; cursor: pointer; font-family: 'Jua';
        }
        /* --- CSS ìŠ¤íƒ€ì¼ ë --- */
    </style>
</head>
<body>
    <div class="game-container">
        <header>
            <h1>ğŸ“ ë¡œë´‡ì˜ ê³¼ì¼ ë¶„ë¥˜ ëŒ€ì‘ì „! ğŸŒ</h1>
            <div class="scoreboard">
                <span>ì ìˆ˜: <span id="score">0</span></span> | 
                <span>ìµœê³  ê¸°ë¡: <span id="high-score">0</span></span>
            </div>
        </header>

        <main>
            <section class="robot-area">
                <div class="robot-wrapper">
                    <img id="robot-face" src="assets/images/robot_normal.png" alt="ğŸ¤–" onerror="this.style.display='none'; document.getElementById('emoji-fallback').style.display='block';">
                    <div id="emoji-fallback" style="display:none; font-size:80px;">ğŸ¤–</div>
                </div>
                
                <div class="conveyor-belt">
                    <div id="current-fruit" class="fruit"></div>
                    <div class="speech-bubble" id="robot-speech">ì´ ê³¼ì¼ì€ ë­ì§€?</div>
                </div>
            </section>

            <section class="brain-pipes">
                <h2>ğŸ§  ë¡œë´‡ì˜ ë‡Œ (ê°€ì¤‘ì¹˜ ì¡°ì ˆ)</h2>
                <p>íŒŒì´í”„ê°€ êµµì„ìˆ˜ë¡ ë¡œë´‡ì€ ê·¸ ìƒ‰ê¹”ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•´ìš”!</p>
                
                <div class="pipe-system">
                    <div class="pipe-line-wrapper">
                        <label>ë¹¨ê°• ì¤‘ìš”ë„ ğŸ”´</label>
                        <input type="range" id="weight-red" min="0" max="100" value="50">
                        <div class="visual-pipe red-pipe-visual" id="visual-red"></div>
                    </div>
                    <div class="pipe-line-wrapper">
                        <label>ë…¸ë‘ ì¤‘ìš”ë„ ğŸŸ¡</label>
                        <input type="range" id="weight-yellow" min="0" max="100" value="50">
                        <div class="visual-pipe yellow-pipe-visual" id="visual-yellow"></div>
                    </div>
                </div>

                <button id="btn-check">ê²°ê³¼ í™•ì¸í•˜ê¸°!</button>
            </section>

            <section class="output-baskets">
                <div class="basket" id="basket-apple"><div class="basket-icon">ğŸ</div><div>ì‚¬ê³¼</div></div>
                <div class="basket" id="basket-banana"><div class="basket-icon">ğŸŒ</div><div>ë°”ë‚˜ë‚˜</div></div>
                <div class="basket locked" id="basket-orange"><div class="basket-icon">ğŸ”’</div><div>ì˜¤ë Œì§€(200ì )</div></div>
            </section>
        </main>
        
        <div id="feedback-modal" class="hidden">
            <h2 id="feedback-title">ì •ë‹µì…ë‹ˆë‹¤!</h2>
            <p id="feedback-message">ë©”ì‹œì§€ ë‚´ìš©</p>
            <button id="btn-next">ë‹¤ìŒ ë¬¸ì œ</button>
        </div>
    </div>

    <audio id="sound-correct" src="assets/sounds/correct.mp3"></audio>
    <audio id="sound-wrong" src="assets/sounds/wrong.mp3"></audio>
    <audio id="sound-unlock" src="assets/sounds/unlock.mp3"></audio>

    <script>
        /* --- JS ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ --- */
        let score = 0;
        let highScore = localStorage.getItem('highScore') || 0;
        let currentFruitType = ''; 
        let difficultyLevel = 1; 
        const UNLOCK_SCORE = 200; 

        const scoreEl = document.getElementById('score');
        const highScoreEl = document.getElementById('high-score');
        const currentFruitEl = document.getElementById('current-fruit');
        const robotSpeech = document.getElementById('robot-speech');
        const btnCheck = document.getElementById('btn-check');
        const weightRed = document.getElementById('weight-red');
        const weightYellow = document.getElementById('weight-yellow');
        const visualRed = document.getElementById('visual-red');
        const visualYellow = document.getElementById('visual-yellow');

        // ì˜¤ë””ì˜¤ ìš”ì†Œ
        const soundCorrect = document.getElementById('sound-correct');
        const soundWrong = document.getElementById('sound-wrong');
        const soundUnlock = document.getElementById('sound-unlock');

        highScoreEl.textContent = highScore;
        updatePipeVisuals();
        nextRound();

        weightRed.addEventListener('input', updatePipeVisuals);
        weightYellow.addEventListener('input', updatePipeVisuals);
        btnCheck.addEventListener('click', predict);
        document.getElementById('btn-next').addEventListener('click', nextRound);

        function updatePipeVisuals() {
            const rVal = weightRed.value;
            const yVal = weightYellow.value;
            visualRed.style.height = (rVal / 2) + 'px'; 
            visualYellow.style.height = (yVal / 2) + 'px';
            visualRed.style.width = (10 + rVal * 0.4) + 'px';
            visualYellow.style.width = (10 + yVal * 0.4) + 'px';
            robotSpeech.textContent = "íìŒ... ì–´ë”” ë³´ì...";
        }

        function nextRound() {
            document.getElementById('feedback-modal').classList.add('hidden');
            resetBaskets();
            setRobotEmotion('normal');
            btnCheck.disabled = false;

            if (score >= UNLOCK_SCORE && difficultyLevel === 1) {
                difficultyLevel = 2;
                unlockOrange();
                return;
            }

            let fruits = ['apple', 'banana'];
            if (difficultyLevel === 2) fruits.push('orange');

            currentFruitType = fruits[Math.floor(Math.random() * fruits.length)];
            currentFruitEl.className = 'fruit ' + currentFruitType;
            robotSpeech.textContent = "ì´ ê³¼ì¼ì€ ë­ì§€? ê°€ë¥´ì³ì¤˜!";
        }

        function unlockOrange() {
            alert("ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ì ìˆ˜ê°€ ì˜¬ë¼ ìƒˆë¡œìš´ ê³¼ì¼ [ì˜¤ë Œì§€]ê°€ ë“±ì¥í•©ë‹ˆë‹¤!");
            playSound(soundUnlock);
            document.getElementById('basket-orange').classList.remove('locked');
            document.getElementById('basket-orange').innerHTML = '<div class="basket-icon">ğŸŠ</div><div>ì˜¤ë Œì§€</div>';
            nextRound();
        }

        function predict() {
            const rWeight = parseInt(weightRed.value);
            const yWeight = parseInt(weightYellow.value);

            const features = {
                'apple': { r: 90, y: 10 },
                'banana': { r: 10, y: 90 },
                'orange': { r: 60, y: 60 }
            };
            const currentFeat = features[currentFruitType];

            let scoreApple = (currentFeat.r * rWeight) + (currentFeat.y * (100 - yWeight));
            let scoreBanana = (currentFeat.r * (100 - rWeight)) + (currentFeat.y * yWeight);
            
            let orangeBonus = 0;
            if (rWeight > 40 && yWeight > 40) orangeBonus = 3000; 
            let scoreOrange = (currentFeat.r * rWeight * 0.5) + (currentFeat.y * yWeight * 0.5) + orangeBonus;

            if (difficultyLevel === 1) scoreOrange = -1;

            let prediction = '';
            if (scoreApple >= scoreBanana && scoreApple >= scoreOrange) prediction = 'apple';
            else if (scoreBanana >= scoreApple && scoreBanana >= scoreOrange) prediction = 'banana';
            else prediction = 'orange';

            resetBaskets();
            document.getElementById('basket-' + prediction).classList.add('active');
            checkAnswer(prediction);
        }

        function checkAnswer(prediction) {
            btnCheck.disabled = true;
            const modal = document.getElementById('feedback-modal');
            const title = document.getElementById('feedback-title');
            const msg = document.getElementById('feedback-message');

            modal.classList.remove('hidden', 'wrong');

            if (prediction === currentFruitType) {
                score += (currentFruitType === 'orange' ? 20 : 10);
                updateScore();
                setRobotEmotion('happy');
                playSound(soundCorrect);
                title.textContent = "ì •ë‹µì…ë‹ˆë‹¤! â­•";
                title.style.color = "#4CAF50";
                msg.textContent = "ë¡œë´‡ì´ ì œëŒ€ë¡œ ë°°ì› ë„¤ìš”! ì°¸ ì˜í–ˆì–´ìš”.";
            } else {
                score = Math.max(0, score - 5);
                updateScore();
                setRobotEmotion('sad');
                playSound(soundWrong);
                modal.classList.add('wrong');
                title.textContent = "í‹€ë ¸ì–´ìš”! âŒ";
                title.style.color = "#FF5252";
                msg.innerHTML = `ì´ê±´ <b>${getFruitName(currentFruitType)}</b>ì˜€ì–´ìš”.<br>íŒŒì´í”„ ë‘ê»˜ë¥¼ ì¡°ì ˆí•´ì„œ íŒíŠ¸ë¥¼ ë‹¤ì‹œ ì¤˜ë³¼ê¹Œìš”?`;
            }
        }

        function updateScore() {
            scoreEl.textContent = score;
            if (score > highScore) {
                highScore = score;
                highScoreEl.textContent = highScore;
                localStorage.setItem('highScore', highScore);
            }
        }

        function resetBaskets() {
            document.querySelectorAll('.basket').forEach(b => b.classList.remove('active'));
        }

        function setRobotEmotion(emotion) {
            let fileName = 'robot_normal.png';
            if (emotion === 'happy') fileName = 'robot_happy.png';
            if (emotion === 'sad') fileName = 'robot_sad.png';
            const img = document.getElementById('robot-face');
            img.src = `assets/images/${fileName}`;
            
            // ì´ë¯¸ì§€ê°€ ì—†ì„ ë•Œë¥¼ ëŒ€ë¹„í•œ ì²˜ë¦¬
            const fallback = document.getElementById('emoji-fallback');
            if(img.style.display === 'none' || img.width === 0) {
                 img.style.display = 'none';
                 fallback.style.display = 'block';
                 if(emotion === 'happy') fallback.textContent = 'ğŸ¥°';
                 else if(emotion === 'sad') fallback.textContent = 'ğŸ˜­';
                 else fallback.textContent = 'ğŸ¤–';
            } else {
                 img.style.display = 'block';
                 fallback.style.display = 'none';
            }
        }

        function playSound(audioEl) {
            if (audioEl) {
                audioEl.currentTime = 0;
                audioEl.play().catch(e => {}); // ì—ëŸ¬ ë¬´ì‹œ
            }
        }

        function getFruitName(type) {
            if (type === 'apple') return 'ì‚¬ê³¼';
            if (type === 'banana') return 'ë°”ë‚˜ë‚˜';
            if (type === 'orange') return 'ì˜¤ë Œì§€';
        }
        /* --- JS ìŠ¤í¬ë¦½íŠ¸ ë --- */
    </script>
</body>
</html>
