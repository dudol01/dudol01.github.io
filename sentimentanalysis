<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë§ˆìŒ ë‚ ì”¨ ì¼ê¸°ì¥ (Fixed Ver.)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; transition: background-color 0.8s ease; }
        .pos-word { background-color: #dbeafe; color: #1e40af; padding: 2px 4px; border-radius: 4px; font-weight: bold; }
        .neg-word { background-color: #fee2e2; color: #991b1b; padding: 2px 4px; border-radius: 4px; font-weight: bold; }
        .theme-very-happy { background-color: #fef9c3; }
        .theme-happy { background-color: #ecfdf5; }
        .theme-neutral { background-color: #f3f4f6; }
        .theme-sad { background-color: #eff6ff; }
        .theme-angry { background-color: #f5f3ff; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="theme-neutral min-h-screen p-6 flex justify-center items-center">

    <div class="bg-white/90 backdrop-blur-sm p-8 rounded-3xl shadow-2xl max-w-3xl w-full border border-white/50 relative">
        <div class="absolute top-0 right-0 -mt-6 -mr-6 text-8xl opacity-10 pointer-events-none header-emoji">ğŸŒ¤ï¸</div>

        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center gap-3">
                <span class="header-emoji text-5xl animate-bounce">ğŸŒ¤ï¸</span>
                ì˜¤ëŠ˜ì˜ ë§ˆìŒ ë‚ ì”¨ ì¼ê¸°
            </h1>
            <p class="text-gray-500 mt-2 text-sm">ë¹…ë°ì´í„°(ë‹¨ì–´ 500+, ëª…ì–¸ 200+)ê°€ íƒ‘ì¬ëœ AIê°€ ë¶„ì„í•´ì¤„ê²Œ!</p>
        </div>

        <div class="mb-6">
            <textarea id="diaryInput" rows="6" placeholder="ì˜¤ëŠ˜ í•™êµì—ì„œ ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”? (ì˜ˆ: ì²´ìœ¡ ì‹œê°„ì— ê³¨ì„ ë„£ì–´ì„œ í¼ ë¯¸ì³¤ë‹¤ê³  ì¹­ì°¬ë°›ìŒ! ê·¼ë° ê¸‰ì‹ì— ì˜¤ì´ê°€ ë‚˜ì™€ì„œ í‚¹ë°›ì•˜ìŒ.)" 
                class="w-full p-4 border-2 border-indigo-100 rounded-xl focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition text-gray-700 resize-none text-lg"></textarea>
            <button onclick="analyzeSentiment()" class="w-full mt-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-md transition transform hover:scale-[1.01] text-lg">
                ğŸ” AI ì •ë°€ ë¶„ì„ ì‹œì‘
            </button>
        </div>

        <div id="resultArea" class="hidden space-y-6">
            <div id="sentimentBanner" class="bg-gray-100 p-5 rounded-2xl flex items-center justify-between border-2 border-gray-200">
                <div>
                    <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">ê²°ê³¼: <span id="sentimentLabel">ë¶„ì„ ì¤‘...</span></h3>
                    <p class="text-gray-500 text-sm mt-1">ê°ì • ì´ì : <span id="totalScore" class="font-bold">0</span>ì </p>
                </div>
                <div id="resultEmoji" class="text-6xl">ğŸ¤”</div>
            </div>

            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                <h4 class="font-bold text-gray-700 mb-3">ğŸ§ AI ë¶„ì„ ë¦¬í¬íŠ¸</h4>
                <div id="highlightedText" class="p-4 bg-gray-50 rounded-xl text-gray-700 leading-relaxed border mb-4 text-lg whitespace-pre-wrap"></div>
                <details class="group">
                    <summary class="flex justify-between items-center font-medium cursor-pointer text-indigo-600 bg-indigo-50 p-3 rounded-lg">
                        <span>ğŸ”¢ ê³„ì‚° ê³¼ì • ë³´ê¸° (XAI)</span>
                        <span class="transition group-open:rotate-180">â–¼</span>
                    </summary>
                    <div id="calculationBreakdown" class="text-sm text-gray-600 mt-3 pl-4 border-l-4 border-indigo-200 font-mono bg-gray-50 p-3 rounded-r-lg overflow-x-auto whitespace-nowrap"></div>
                </details>
            </div>

            <div id="idiomCard" class="bg-gradient-to-br from-yellow-50 to-amber-100 border-2 border-amber-200 p-6 rounded-2xl relative overflow-hidden shadow-md">
                <div class="absolute top-0 right-0 text-8xl opacity-10 pointer-events-none idiom-bg-emoji">ğŸ“œ</div>
                <h4 class="font-bold text-amber-800 mb-2 text-lg">ğŸ’Š ì„ ìƒë‹˜ì˜ AI ì²˜ë°©ì „</h4>
                <div class="flex items-center gap-4 mt-4">
                    <div id="idiomEmoji" class="text-5xl bg-white p-3 rounded-full shadow-sm">ğŸŒ±</div>
                    <div>
                        <h5 id="idiomTitle" class="text-2xl font-bold text-gray-800 mb-1">ì œëª©</h5>
                        <p id="idiomDesc" class="text-gray-700">ì„¤ëª…</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // [1] ë°ì´í„° ì •ì˜
        const POSITIVE_WORDS = [
            "ì¢‹ì•„", "ì¢‹ì€", "í–‰ë³µ", "ê¸°ë»", "ì¦ê±°", "ì‹ ë‚˜", "ê°ì‚¬", "ê³ ë§ˆ", "ì‚¬ë‘", "í›Œë¥­", "ë§Œì¡±", "í¸ì•ˆ", "ë¿Œë“¯", "ì„±ê³µ", "í¬ë§", "ê¸°ëŒ€", "ì„¤ë ˆ", "ìµœê³ ", "ë©‹ì ¸", "ì•„ë¦„", "ìƒì¾Œ", "í¬ê·¼", "ë”°ëœ»", "ì¹œì ˆ", "ì›ƒìŒ", "í™œê¸°", "ìš©ê¸°", "ìì‹ ê°", "ë³´ëŒ", "ì¹­ì°¬",
            "í•©ê²©", "í†µê³¼", "100ì ", "Aë“±ê¸‰", "ìƒì¥", "ì¹­ì°¬ìŠ¤í‹°ì»¤", "ì¼ë“±", "ìš°ìŠ¹", "ìŠ¹ë¦¬", "ë‹¨ì¶•ìˆ˜ì—…", "íœ´ê°•", "ë°©í•™", "ì¡¸ì—…", "ì…í•™", "ê¸‰ì‹ ë§›ìˆë‹¤", "ë§›ìˆëŠ” ê¸‰ì‹", "ì²´ìœ¡", "í˜„ì¥ì²´í—˜", "ìˆ˜í•™ì—¬í–‰", "ì‰¬ëŠ”ì‹œê°„", "ì ì‹¬ì‹œê°„", "ë†€ê¸°", "ì¹œêµ¬ë‘", "ì§ê¿ì´ë‘", "ì¸ê¸°",
            "ê¿€ì¼", "í•µì¼", "ëŒ€ë°•", "ê°œì´ë“", "ë ˆì „ë“œ", "ê°“", "ìºë¦¬", "í•˜ë“œìºë¦¬", "ë‚˜ì´ìŠ¤", "ì˜¤ì§€êµ¬ìš”", "ì§€ë¦¬êµ¬ìš”", "í¼ë¯¸ì³¤ë‹¤", "ê°“ìƒ", "ì„±ë•", "ëµì‘", "Flex", "ì¸ì •", "í‚¹ì •", "ì¶”ì²œ", "ê°•ì¶”", "ë–¡ìƒ", "ì‚¬ì´ë‹¤", "ì™„ë²½", "ê¹”ë”", "ì†Œë¦„", "ì°¢ì—ˆë‹¤"
        ];

        const NEGATIVE_WORDS = [
            "ì‹«ì–´", "ë‚˜ìœ", "ìŠ¬í¼", "ìš°ìš¸", "ì§œì¦", "í™”ë‚˜", "ë¶„ë…¸", "ë¯¸ì›Œ", "ì›ë§", "ê±±ì •", "ë¶ˆì•ˆ", "ë‘ë ¤", "ë¬´ì„œ", "ì‹¤ë§", "ì¢Œì ˆ", "í¬ê¸°", "í›„íšŒ", "ì•„íŒŒ", "ê³ í†µ", "ê´´ë¡œ", "ì§€ì³", "í”¼ê³¤", "í˜ë“¤", "ê·€ì°®", "ì§€ë£¨", "ì‹¬ì‹¬", "ë‹µë‹µ", "ì–µìš¸", "ë¶€ë„", "ì°½í”¼",
            "ìˆ™ì œ", "ê³¼ì œ", "ì‹œí—˜", "ìˆ˜í–‰í‰ê°€", "ìª½ì§€ì‹œí—˜", "ë‚˜ë¨¸ì§€ê³µë¶€", "ì¬ì‹œí—˜", "ë¶ˆí•©ê²©", "ë¹µì ", "ì˜¤ë‹µ", "ì§€ê°", "ê²°ì„", "ì²­ì†Œ", "ë‹¹ë²ˆ", "ì”ì†Œë¦¬", "ê¾¸ì¤‘", "í˜¼ë‚¨", "ì™•ë”°", "ë”°ëŒë¦¼", "ì‹¸ì›€", "ë‹¤íˆ¼", "ì ˆêµ", "ì´ë³„", "ê¸‰ì‹ ë§›ì—†", "ë§›ì—†ëŠ” ê¸‰ì‹",
            "ë…¸ì¼", "í•µë…¸ì¼", "ë§í•¨", "í­ë§", "ê°œë§", "ë¹¡ì¹¨", "ê°œë¹¡", "í‚¹ë°›ë„¤", "í‚¹ë°›ì•„", "ì—´ë°›", "ì†ì ˆ", "ê·¹í˜", "ë¹„í˜¸ê°", "ê¼°ëŒ€", "ì¼ë¯¼", "ì°ë”°", "í˜¸êµ¬", "í‘ì—­ì‚¬", "ê³ êµ¬ë§ˆ", "ë‹µì •ë„ˆ", "ë¬´ë¦¬ìˆ˜", "ë‡Œì ˆ", "ì–µê¹Œ", "íŠ¸ë¡¤", "ë¯¼í", "íƒˆì£¼", "ë–¡ë½", "ìµœì•…"
        ];

        const IDIOMS = {
            positive: [
                {t:"ê¸ˆìƒì²¨í™” (éŒ¦ä¸Šæ·»èŠ±)", d:"ë¹„ë‹¨ ìœ„ì— ê½ƒì„ ë”í•œë‹¤ëŠ” ëœ». ì¢‹ì€ ì¼ì— ì¢‹ì€ ì¼ì´ ê²¹ì³¤êµ¬ë‚˜! ìµœê³ ì•¼!", e:"ğŸŒ¸"},
                {t:"ìŠ¹ìŠ¹ì¥êµ¬ (ä¹˜å‹é•·é©…)", d:"ì‹¸ì›€ì— ì´ê¸´ ê¸°ì„¸ë¥¼ íƒ€ê³  ê³„ì† ëª°ì•„ì¹¨. ì§€ê¸ˆ ë„ˆì˜ ê¸°ì„¸ê°€ ë”± ê·¸ë˜!", e:"ğŸš€"},
                {t:"ì¼ì·¨ì›”ì¥ (æ—¥å°±æœˆå°‡)", d:"ë‚ ë§ˆë‹¤ ë‹¬ë§ˆë‹¤ ë°œì „í•˜ê³  ìˆì–´. ë„ˆì˜ ì„±ì¥ì´ ëˆˆë¶€ì‹œë‹¤!", e:"ğŸ“ˆ"},
                {t:"íŒŒì£½ì§€ì„¸ (ç ´ç«¹ä¹‹å‹¢)", d:"ëŒ€ë‚˜ë¬´ë¥¼ ìª¼ê°œëŠ” ê¸°ì„¸! ì•„ë¬´ë„ ë„ˆë¥¼ ë§‰ì„ ìˆ˜ ì—†ì–´.", e:"ğŸ‹"},
                {t:"ê³ ì§„ê°ë˜ (è‹¦ç›¡ç”˜ä¾†)", d:"ê³ ìƒ ëì— ë‚™ì´ ì˜¨ë‹¤! ê·¸ë™ì•ˆ ë…¸ë ¥í•œ ë³´ìƒì„ ë°›ëŠ”êµ¬ë‚˜.", e:"ğŸ¬"},
                {t:"ê°€ëŠ” ë‚ ì´ ì¥ë‚ ", d:"ìš°ì—°íˆ ê°”ë‹¤ê°€ ì¢‹ì€ ì¼ì„ ë§Œë‚¬ë„¤! ì˜¤ëŠ˜ì€ ë„ˆì˜ ë‚ ì´ì•¼.", e:"ğŸ€"},
                {t:"ë‹¤ë‹¤ìµì„  (å¤šå¤šç›Šå–„)", d:"ë§ìœ¼ë©´ ë§ì„ìˆ˜ë¡ ì¢‹ì•„. í–‰ë³µê³¼ ì¦ê±°ì›€ì€ ë§ì„ìˆ˜ë¡ ì¢‹ì§€!", e:"ğŸ"},
                {t:"ì²œì¬ì¼ìš° (åƒè¼‰ä¸€é‡)", d:"ì²œ ë…„ì— í•œ ë²ˆ ë§Œë‚  ì¢‹ì€ ê¸°íšŒ! ë†“ì¹˜ì§€ ë§ê³  ê½‰ ì¡ì•„!", e:"âš¡"},
                {t:"í¼ ë¯¸ì³¤ë‹¤!", d:"(AI íŠ¹ë³„ ì¹­ì°¬) ì˜¤ëŠ˜ ë„ˆì˜ ì»¨ë””ì…˜ì€ ì •ë§ ìµœê³ ì˜€ì–´! ì´ëŒ€ë¡œë§Œ ê°€ì.", e:"ğŸ˜"}
            ],
            negative: [
                {t:"ë¹„ ì˜¨ ë’¤ì— ë•…ì´ êµ³ëŠ”ë‹¤", d:"ì§€ê¸ˆì€ í˜ë“¤ê³  ì•„í”„ì§€ë§Œ, ì´ ì¼ì„ ê²ªê³  ë‚˜ë©´ ë„Œ í›¨ì”¬ ë” ë‹¨ë‹¨í•´ì§ˆ ê±°ì•¼.", e:"ğŸŒ±"},
                {t:"ìƒˆì˜¹ì§€ë§ˆ (å¡ç¿ä¹‹é¦¬)", d:"ì¸ìƒì˜ ê¸¸í‰í™”ë³µì€ ì•Œ ìˆ˜ ì—†ì–´. ì˜¤ëŠ˜ì˜ ë‚˜ìœ ì¼ì´ ë‚´ì¼ì˜ ì¢‹ì€ ì¼ì´ ë  ìˆ˜ë„ ìˆì–´.", e:"ğŸ´"},
                {t:"ì „í™”ìœ„ë³µ (è½‰ç¦çˆ²ç¦)", d:"í™”ê°€ ë°”ë€Œì–´ ì˜¤íˆë ¤ ë³µì´ ë  ê±°ì•¼. ì‹¤ìˆ˜ë¥¼ ê¸°íšŒë¡œ ë°”ê¿”ë³´ì.", e:"ğŸ”„"},
                {t:"ì¹ ì „íŒ”ê¸° (ä¸ƒé¡šå…«èµ·)", d:"ì¼ê³± ë²ˆ ë„˜ì–´ì ¸ë„ ì—¬ëŸ ë²ˆ ì¼ì–´ë‚˜ì. í¬ê¸°í•˜ì§€ ì•ŠëŠ” ë„¤ê°€ ì±”í”¼ì–¸ì´ì•¼.", e:"ğŸ¥Š"},
                {t:"ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆ", d:"ì—ë””ìŠ¨ë„ ìˆ˜ì²œ ë²ˆ ì‹¤íŒ¨í–ˆì–´. ì˜¤ëŠ˜ì˜ ì‹¤íŒ¨ëŠ” ì„±ê³µìœ¼ë¡œ ê°€ëŠ” ì—°ìŠµì¼ ë¿ì´ì•¼.", e:"ğŸ’¡"},
                {t:"ëŒ€ê¸°ë§Œì„± (å¤§å™¨æ™©æˆ)", d:"í° ê·¸ë¦‡ì€ ëŠ¦ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ë²•. ë„ˆëŠ” í¬ê²Œ ë  ì‚¬ëŒì´ë¼ ì‹œê°„ì´ ì¢€ ê±¸ë¦¬ëŠ” ê±°ì•¼.", e:"ğŸº"},
                {t:"ì´ ë˜í•œ ì§€ë‚˜ê°€ë¦¬ë¼", d:"ì§€ê¸ˆì˜ ìŠ¬í””ë„ ì˜ì›í•˜ì§€ ì•Šì•„. ê³§ ì›ƒì„ ë‚ ì´ ì˜¬ ê±°ì•¼.", e:"â³"},
                {t:"ê´œì°®ì•„, ì˜í•˜ê³  ìˆì–´", d:"(AI ìœ„ë¡œ) ê°€ë”ì€ ê·¸ëƒ¥ ìš¸ì–´ë„ ë¼. ì„ ìƒë‹˜ê³¼ AIëŠ” ì–¸ì œë‚˜ ë„¤ í¸ì´ì•¼.", e:"â¤ï¸"}
            ],
            neutral: [
                {t:"ì—­ì§€ì‚¬ì§€ (æ˜“åœ°æ€ä¹‹)", d:"ì…ì¥ì„ ë°”ê¿”ì„œ ìƒê°í•´ë³´ì. ì¹œêµ¬ì˜ ë§ˆìŒì„ ì´í•´í•˜ë©´ ë‹µì´ ë³´ì¼ ê±°ì•¼.", e:"ğŸ¤”"},
                {t:"ìœ ë¹„ë¬´í™˜ (æœ‰å‚™ç„¡æ‚£)", d:"ë¯¸ë¦¬ ì¤€ë¹„í•˜ë©´ ê±±ì •ì´ ì—†ì–´. ë‚´ì¼ ì¤€ë¹„ë¬¼ì„ ë¯¸ë¦¬ ì±™ê²¨ë³¼ê¹Œ?", e:"ğŸ’"},
                {t:"ë“±ì” ë°‘ì´ ì–´ë‘¡ë‹¤", d:"í•´ë‹µì€ ì˜ì™¸ë¡œ ì•„ì£¼ ê°€ê¹Œìš´ ê³³ì— ìˆì„ì§€ë„ ëª°ë¼. ì£¼ìœ„ë¥¼ ë‘˜ëŸ¬ë´.", e:"ğŸ•¯ï¸"},
                {t:"ê°€ëŠ” ë§ì´ ê³ ì™€ì•¼ ì˜¤ëŠ” ë§ì´ ê³±ë‹¤", d:"ë‚´ê°€ ë¨¼ì € ì˜ˆì˜ê²Œ ë§í•˜ë©´, ì¹œêµ¬ë„ ì˜ˆì˜ê²Œ ë§í•´ì¤„ ê±°ì•¼.", e:"ğŸ—£ï¸"},
                {t:"ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬", d:"ë°± ë²ˆ ë“£ëŠ” ê²ƒë³´ë‹¤ í•œ ë²ˆ ë³´ëŠ” ê²Œ ë‚«ì§€. ì§ì ‘ ê²½í—˜í•œ ê±´ í° ìì‚°ì´ì•¼.", e:"ğŸ‘€"},
                {t:"ì‹œì¥ì´ ë°˜ì°¬ì´ë‹¤", d:"ë°°ê³ í”„ë©´ ë­ë“  ë§›ìˆì§€. í˜¹ì‹œ ë°°ê³ íŒŒì„œ ì˜ˆë¯¼í•œ ê±´ ì•„ë‹ê¹Œ?", e:"ğŸš"}
            ]
        };

        // [2] ì‚¬ì „ ì´ˆê¸°í™”
        let sentimentDict = {};
        POSITIVE_WORDS.forEach(word => {
            let score = 2; 
            if(word.includes("í•µ") || word.includes("ê°“") || word.includes("ìµœê³ ")) score = 3;
            sentimentDict[word] = score;
        });
        NEGATIVE_WORDS.forEach(word => {
            let score = -2;
            if(word.includes("ê°œ") || word.includes("í•µ") || word.includes("ë§") || word.includes("ìµœì•…")) score = -3;
            sentimentDict[word] = score;
        });

        // [3] ë¶„ì„ ë¡œì§ (Placeholder ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •ë¨)
        function analyzeSentiment() {
            const rawText = document.getElementById('diaryInput').value;
            if (!rawText.trim()) { alert("ì¼ê¸°ë¥¼ ì¨ì£¼ì„¸ìš”!"); return; }

            let totalScore = 0;
            let tempHTML = rawText; 
            let calculationSteps = [];
            
            // í‚¤ë¥¼ ê¸¸ì´ìˆœ(ê¸´ ë‹¨ì–´ ë¨¼ì €)ìœ¼ë¡œ ì •ë ¬
            let allKeys = Object.keys(sentimentDict).sort((a, b) => b.length - a.length);
            
            // **í•µì‹¬ ìˆ˜ì •: ê°€ë©´ ì”Œìš°ê¸° (Placeholder)**
            // ì´ë¯¸ ë°”ë€ ë‹¨ì–´ë¥¼ ë˜ ë°”ê¾¸ì§€ ì•Šë„ë¡, ë§¤ì¹­ëœ ë‹¨ì–´ë¥¼ __MATCH_0__ ê°™ì€ ì„ì‹œ ê¸°í˜¸ë¡œ ë°”ê¿‰ë‹ˆë‹¤.
            let matches = []; 

            allKeys.forEach((key) => {
                if (tempHTML.includes(key)) {
                    // ë‹¨ì–´ ì°¾ê¸° (ì •ê·œì‹ ìƒì„± ì‹œ íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ í•„ìš”í•˜ì§€ë§Œ, ì—¬ê¸° ë°ì´í„°ëŠ” ì•ˆì „í•¨)
                    const regex = new RegExp(key, 'g');
                    
                    // ë§¤ì¹­ë˜ëŠ” ê²Œ ìˆë‹¤ë©´
                    if (tempHTML.match(regex)) {
                        const count = (tempHTML.match(regex) || []).length;
                        const score = sentimentDict[key];
                        
                        // ì ìˆ˜ í•©ì‚°
                        totalScore += (score * count);
                        for(let i=0; i<count; i++) {
                            calculationSteps.push(`${key}(${score > 0 ? '+'+score : score})`);
                        }

                        // ë‚˜ì¤‘ì— êµì²´í•  HTML íƒœê·¸ë¥¼ ì €ì¥
                        const className = score > 0 ? 'pos-word' : 'neg-word';
                        const replacementHTML = `<span class="${className}">${key}</span>`;
                        
                        // í˜„ì¬ ìˆœë²ˆ(ID)ì„ ë¶€ì—¬í•´ì„œ ë°°ì—´ì— ì €ì¥
                        const placeholderID = `__MATCH_${matches.length}__`;
                        matches.push(replacementHTML);

                        // ë³¸ë¬¸ì€ ì„ì‹œ ê¸°í˜¸ë¡œ êµì²´ (ì´ì œ ë” ì´ìƒ 'ë‹¨ì–´'ê°€ ì•„ë‹ˆë¯€ë¡œ ì¤‘ë³µ ê²€ìƒ‰ ì•ˆ ë¨)
                        tempHTML = tempHTML.replace(regex, placeholderID);
                    }
                }
            });

            // ëª¨ë“  ê²€ìƒ‰ì´ ëë‚œ í›„, ì„ì‹œ ê¸°í˜¸(__MATCH_0__)ë¥¼ ì›ë˜ì˜ HTML íƒœê·¸ë¡œ ì¼ê´„ ë³µì›
            matches.forEach((html, index) => {
                // ì •í™•íˆ í•´ë‹¹ IDë§Œ ë°”ê¿ˆ
                const placeholderRegex = new RegExp(`__MATCH_${index}__`, 'g');
                tempHTML = tempHTML.replace(placeholderRegex, html);
            });

            renderResults(totalScore, tempHTML, calculationSteps);
        }

        function renderResults(score, html, steps) {
            const resultArea = document.getElementById('resultArea');
            const totalScoreEl = document.getElementById('totalScore');
            
            resultArea.classList.remove('hidden');
            totalScoreEl.innerText = score;
            document.getElementById('highlightedText').innerHTML = html;

            const calcText = steps.length > 0 
                ? steps.join(" + ").replace(/\+\-/g, '- ') + ` = ${score}ì `
                : "ê°ì • ë‹¨ì–´ë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”. (0ì )";
            document.getElementById('calculationBreakdown').innerText = calcText;

            // í…Œë§ˆ ì„¤ì •
            let theme, label, mainEmoji, idiomType;
            if (score >= 5) { theme='theme-very-happy'; label='ì™„ì „ ëŒ€ë°•! (ë§¤ìš° ë§‘ìŒ)'; mainEmoji='ğŸŒ'; idiomType='positive'; }
            else if (score >= 1) { theme='theme-happy'; label='ê¸°ë¶„ ì¢‹ìŒ (ë§‘ìŒ)'; mainEmoji='ğŸŒ¤ï¸'; idiomType='positive'; }
            else if (score === 0) { theme='theme-neutral'; label='ê·¸ëŸ­ì €ëŸ­ (êµ¬ë¦„)'; mainEmoji='â˜ï¸'; idiomType='neutral'; }
            else if (score >= -4) { theme='theme-sad'; label='ì¡°ê¸ˆ ìš°ìš¸ (ë¹„)'; mainEmoji='ğŸŒ§ï¸'; idiomType='negative'; }
            else { theme='theme-angry'; label='ë§ˆìŒì´ í˜ë“¤ì–´ (ì²œë‘¥ë²ˆê°œ)'; mainEmoji='â›ˆï¸'; idiomType='negative'; }

            // UI ì—…ë°ì´íŠ¸
            document.body.className = `${theme} min-h-screen p-6 flex justify-center items-center`;
            document.querySelectorAll('.header-emoji').forEach(el => el.innerText = mainEmoji);
            document.getElementById('sentimentLabel').innerText = label;
            document.getElementById('resultEmoji').innerText = mainEmoji;

            // ê´€ìš©êµ¬ ëœë¤ ì„ íƒ
            const list = IDIOMS[idiomType];
            const pick = list[Math.floor(Math.random() * list.length)];
            
            document.getElementById('idiomTitle').innerText = pick.t;
            document.getElementById('idiomDesc').innerText = pick.d;
            document.getElementById('idiomEmoji').innerText = pick.e;
            document.querySelector('.idiom-bg-emoji').innerText = pick.e;

            resultArea.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
