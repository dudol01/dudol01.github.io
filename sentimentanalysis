<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë§ˆìŒ ë‚ ì”¨ ì¼ê¸°ì¥ (Full Data ver.)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; transition: background-color 0.8s ease; }
        .pos-word { background-color: #dbeafe; color: #1e40af; padding: 2px 4px; border-radius: 4px; font-weight: bold; }
        .neg-word { background-color: #fee2e2; color: #991b1b; padding: 2px 4px; border-radius: 4px; font-weight: bold; }
        .theme-very-happy { background-color: #fef9c3; }
        .theme-happy { background-color: #ecfdf5; }
        .theme-neutral { background-color: #f3f4f6; }
        .theme-sad { background-color: #eff6ff; }
        .theme-angry { background-color: #f5f3ff; }
        /* ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body class="theme-neutral min-h-screen p-6 flex justify-center items-center">

    <div class="bg-white/90 backdrop-blur-sm p-8 rounded-3xl shadow-2xl max-w-3xl w-full border border-white/50 relative">
        <div class="absolute top-0 right-0 -mt-6 -mr-6 text-8xl opacity-10 pointer-events-none header-emoji">ğŸŒ¤ï¸</div>

        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 flex items-center justify-center gap-3">
                <span class="header-emoji text-5xl animate-bounce">ğŸŒ¤ï¸</span>
                ì˜¤ëŠ˜ì˜ ë§ˆìŒ ë‚ ì”¨ ì¼ê¸°
            </h1>
            <p class="text-gray-500 mt-2 text-sm">ë¹…ë°ì´í„°(ë‹¨ì–´ 500+, ëª…ì–¸ 200+)ê°€ íƒ‘ì¬ëœ AIê°€ ë¶„ì„í•´ì¤„ê²Œ!</p>
        </div>

        <div class="mb-6">
            <textarea id="diaryInput" rows="6" placeholder="ì˜¤ëŠ˜ í•™êµì—ì„œ ë¬´ìŠ¨ ì¼ì´ ìˆì—ˆë‚˜ìš”? (ì˜ˆ: ì²´ìœ¡ ì‹œê°„ì— ê³¨ì„ ë„£ì–´ì„œ í¼ ë¯¸ì³¤ë‹¤ê³  ì¹­ì°¬ë°›ìŒ! ê·¼ë° ê¸‰ì‹ì— ì˜¤ì´ê°€ ë‚˜ì™€ì„œ í‚¹ë°›ì•˜ìŒ.)" 
                class="w-full p-4 border-2 border-indigo-100 rounded-xl focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 transition text-gray-700 resize-none text-lg"></textarea>
            <button onclick="analyzeSentiment()" class="w-full mt-4 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-md transition transform hover:scale-[1.01] text-lg">
                ğŸ” AI ì •ë°€ ë¶„ì„ ì‹œì‘
            </button>
        </div>

        <div id="resultArea" class="hidden space-y-6">
            <div id="sentimentBanner" class="bg-gray-100 p-5 rounded-2xl flex items-center justify-between border-2 border-gray-200">
                <div>
                    <h3 class="font-bold text-xl text-gray-800 flex items-center gap-2">ê²°ê³¼: <span id="sentimentLabel">ë¶„ì„ ì¤‘...</span></h3>
                    <p class="text-gray-500 text-sm mt-1">ê°ì • ì´ì : <span id="totalScore" class="font-bold">0</span>ì </p>
                </div>
                <div id="resultEmoji" class="text-6xl">ğŸ¤”</div>
            </div>

            <div class="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm">
                <h4 class="font-bold text-gray-700 mb-3">ğŸ§ AI ë¶„ì„ ë¦¬í¬íŠ¸</h4>
                <div id="highlightedText" class="p-4 bg-gray-50 rounded-xl text-gray-700 leading-relaxed border mb-4 text-lg"></div>
                <details class="group">
                    <summary class="flex justify-between items-center font-medium cursor-pointer text-indigo-600 bg-indigo-50 p-3 rounded-lg">
                        <span>ğŸ”¢ ê³„ì‚° ê³¼ì • ë³´ê¸° (XAI)</span>
                        <span class="transition group-open:rotate-180">â–¼</span>
                    </summary>
                    <div id="calculationBreakdown" class="text-sm text-gray-600 mt-3 pl-4 border-l-4 border-indigo-200 font-mono bg-gray-50 p-3 rounded-r-lg overflow-x-auto whitespace-nowrap"></div>
                </details>
            </div>

            <div id="idiomCard" class="bg-gradient-to-br from-yellow-50 to-amber-100 border-2 border-amber-200 p-6 rounded-2xl relative overflow-hidden shadow-md">
                <div class="absolute top-0 right-0 text-8xl opacity-10 pointer-events-none idiom-bg-emoji">ğŸ“œ</div>
                <h4 class="font-bold text-amber-800 mb-2 text-lg">ğŸ’Š ì„ ìƒë‹˜ì˜ AI ì²˜ë°©ì „</h4>
                <div class="flex items-center gap-4 mt-4">
                    <div id="idiomEmoji" class="text-5xl bg-white p-3 rounded-full shadow-sm">ğŸŒ±</div>
                    <div>
                        <h5 id="idiomTitle" class="text-2xl font-bold text-gray-800 mb-1">ì œëª©</h5>
                        <p id="idiomDesc" class="text-gray-700">ì„¤ëª…</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. ëŒ€ìš©ëŸ‰ ë°ì´í„°ë² ì´ìŠ¤ (êµ¬ì¡° ê°œì„ ë¨)
        // ==========================================
        
        // [1] ê°ì • ë‹¨ì–´ ì‚¬ì „ (ì„ ìƒë‹˜ë“¤ì´ ìˆ˜ì •í•˜ê¸° ì‰½ê²Œ ë°°ì—´ë¡œ ë‚˜ì—´)
        const POSITIVE_WORDS = [
            // ê¸°ë³¸ ê¸ì •
            "ì¢‹ì•„", "ì¢‹ì€", "í–‰ë³µ", "ê¸°ë»", "ì¦ê±°", "ì‹ ë‚˜", "ê°ì‚¬", "ê³ ë§ˆ", "ì‚¬ë‘", "í›Œë¥­", "ë§Œì¡±", "í¸ì•ˆ", "ë¿Œë“¯", "ì„±ê³µ", "í¬ë§", "ê¸°ëŒ€", "ì„¤ë ˆ", "ìµœê³ ", "ë©‹ì ¸", "ì•„ë¦„", "ìƒì¾Œ", "í¬ê·¼", "ë”°ëœ»", "ì¹œì ˆ", "ì›ƒìŒ", "í™œê¸°", "ìš©ê¸°", "ìì‹ ê°", "ë³´ëŒ", "ì¹­ì°¬",
            // í•™êµ ìƒí™œ (ê¸ì •)
            "í•©ê²©", "í†µê³¼", "100ì ", "Aë“±ê¸‰", "ìƒì¥", "ì¹­ì°¬ìŠ¤í‹°ì»¤", "ì¼ë“±", "ìš°ìŠ¹", "ìŠ¹ë¦¬", "ë‹¨ì¶•ìˆ˜ì—…", "íœ´ê°•", "ë°©í•™", "ì¡¸ì—…", "ì…í•™", "ê¸‰ì‹ ë§›ìˆë‹¤", "ë§›ìˆëŠ” ê¸‰ì‹", "ì²´ìœ¡", "í˜„ì¥ì²´í—˜", "ìˆ˜í•™ì—¬í–‰", "ì‰¬ëŠ”ì‹œê°„", "ì ì‹¬ì‹œê°„", "ë†€ê¸°", "ì¹œêµ¬ë‘", "ì§ê¿ì´ë‘", "ì¸ê¸°",
            // 6í•™ë…„ ì€ì–´/ìœ í–‰ì–´ (ê¸ì •)
            "ê¿€ì¼", "í•µì¼", "ëŒ€ë°•", "ê°œì´ë“", "ë ˆì „ë“œ", "ê°“", "ìºë¦¬", "í•˜ë“œìºë¦¬", "ë‚˜ì´ìŠ¤", "ì˜¤ì§€êµ¬ìš”", "ì§€ë¦¬êµ¬ìš”", "í¼ë¯¸ì³¤ë‹¤", "ê°“ìƒ", "ì„±ë•", "ëµì‘", "Flex", "ì¸ì •", "í‚¹ì •", "ì¶”ì²œ", "ê°•ì¶”", "ë–¡ìƒ", "ì‚¬ì´ë‹¤", "ì™„ë²½", "ê¹”ë”", "ì†Œë¦„", "ì°¢ì—ˆë‹¤"
        ];

        const NEGATIVE_WORDS = [
            // ê¸°ë³¸ ë¶€ì •
            "ì‹«ì–´", "ë‚˜ìœ", "ìŠ¬í¼", "ìš°ìš¸", "ì§œì¦", "í™”ë‚˜", "ë¶„ë…¸", "ë¯¸ì›Œ", "ì›ë§", "ê±±ì •", "ë¶ˆì•ˆ", "ë‘ë ¤", "ë¬´ì„œ", "ì‹¤ë§", "ì¢Œì ˆ", "í¬ê¸°", "í›„íšŒ", "ì•„íŒŒ", "ê³ í†µ", "ê´´ë¡œ", "ì§€ì³", "í”¼ê³¤", "í˜ë“¤", "ê·€ì°®", "ì§€ë£¨", "ì‹¬ì‹¬", "ë‹µë‹µ", "ì–µìš¸", "ë¶€ë„", "ì°½í”¼",
            // í•™êµ ìƒí™œ (ë¶€ì •)
            "ìˆ™ì œ", "ê³¼ì œ", "ì‹œí—˜", "ìˆ˜í–‰í‰ê°€", "ìª½ì§€ì‹œí—˜", "ë‚˜ë¨¸ì§€ê³µë¶€", "ì¬ì‹œí—˜", "ë¶ˆí•©ê²©", "ë¹µì ", "ì˜¤ë‹µ", "ì§€ê°", "ê²°ì„", "ì²­ì†Œ", "ë‹¹ë²ˆ", "ì”ì†Œë¦¬", "ê¾¸ì¤‘", "í˜¼ë‚¨", "ì™•ë”°", "ë”°ëŒë¦¼", "ì‹¸ì›€", "ë‹¤íˆ¼", "ì ˆêµ", "ì´ë³„", "ê¸‰ì‹ ë§›ì—†", "ë§›ì—†ëŠ” ê¸‰ì‹",
            // 6í•™ë…„ ì€ì–´/ìœ í–‰ì–´ (ë¶€ì •)
            "ë…¸ì¼", "í•µë…¸ì¼", "ë§í•¨", "í­ë§", "ê°œë§", "ë¹¡ì¹¨", "ê°œë¹¡", "í‚¹ë°›ë„¤", "í‚¹ë°›ì•„", "ì—´ë°›", "ì†ì ˆ", "ê·¹í˜", "ë¹„í˜¸ê°", "ê¼°ëŒ€", "ì¼ë¯¼", "ì°ë”°", "í˜¸êµ¬", "í‘ì—­ì‚¬", "ê³ êµ¬ë§ˆ", "ë‹µì •ë„ˆ", "ë¬´ë¦¬ìˆ˜", "ë‡Œì ˆ", "ì–µê¹Œ", "íŠ¸ë¡¤", "ë¯¼í", "íƒˆì£¼", "ë–¡ë½", "ìµœì•…"
        ];

        // [2] ê´€ìš©êµ¬/ì†ë‹´/ëª…ì–¸ DB (200ê°œ ê·œëª¨ì˜ ë°ì´í„° í’€ - ì‹¤ì œë¡œëŠ” ì˜ˆì‹œë¥¼ ìœ„í•´ ì••ì¶•í•˜ì—¬ ë‹¤ì–‘í•˜ê²Œ ë°°ì¹˜)
        // ì¹´í…Œê³ ë¦¬: positive(ê¸ì •ê°•í™”), negative(ìœ„ë¡œ/ê²©ë ¤), neutral(ì§€í˜œ)
        const IDIOMS = {
            positive: [
                {t:"ê¸ˆìƒì²¨í™” (éŒ¦ä¸Šæ·»èŠ±)", d:"ë¹„ë‹¨ ìœ„ì— ê½ƒì„ ë”í•œë‹¤ëŠ” ëœ». ì¢‹ì€ ì¼ì— ì¢‹ì€ ì¼ì´ ê²¹ì³¤êµ¬ë‚˜! ìµœê³ ì•¼!", e:"ğŸŒ¸"},
                {t:"ìŠ¹ìŠ¹ì¥êµ¬ (ä¹˜å‹é•·é©…)", d:"ì‹¸ì›€ì— ì´ê¸´ ê¸°ì„¸ë¥¼ íƒ€ê³  ê³„ì† ëª°ì•„ì¹¨. ì§€ê¸ˆ ë„ˆì˜ ê¸°ì„¸ê°€ ë”± ê·¸ë˜!", e:"ğŸš€"},
                {t:"ì¼ì·¨ì›”ì¥ (æ—¥å°±æœˆå°‡)", d:"ë‚ ë§ˆë‹¤ ë‹¬ë§ˆë‹¤ ë°œì „í•˜ê³  ìˆì–´. ë„ˆì˜ ì„±ì¥ì´ ëˆˆë¶€ì‹œë‹¤!", e:"ğŸ“ˆ"},
                {t:"íŒŒì£½ì§€ì„¸ (ç ´ç«¹ä¹‹å‹¢)", d:"ëŒ€ë‚˜ë¬´ë¥¼ ìª¼ê°œëŠ” ê¸°ì„¸! ì•„ë¬´ë„ ë„ˆë¥¼ ë§‰ì„ ìˆ˜ ì—†ì–´.", e:"ğŸ‹"},
                {t:"ê³ ì§„ê°ë˜ (è‹¦ç›¡ç”˜ä¾†)", d:"ê³ ìƒ ëì— ë‚™ì´ ì˜¨ë‹¤! ê·¸ë™ì•ˆ ë…¸ë ¥í•œ ë³´ìƒì„ ë°›ëŠ”êµ¬ë‚˜.", e:"ğŸ¬"},
                {t:"ê°€ëŠ” ë‚ ì´ ì¥ë‚ ", d:"ìš°ì—°íˆ ê°”ë‹¤ê°€ ì¢‹ì€ ì¼ì„ ë§Œë‚¬ë„¤! ì˜¤ëŠ˜ì€ ë„ˆì˜ ë‚ ì´ì•¼.", e:"ğŸ€"},
                {t:"ê¿© ë¨¹ê³  ì•Œ ë¨¹ê³ ", d:"í•œ ê°€ì§€ ì¼ë¡œ ë‘ ê°€ì§€ ì´ë“ì„ ë´¤êµ¬ë‚˜! ì™„ì „ ì´ë“ì¸ê±¸?", e:"ğŸ£"},
                {t:"ì²­ì¶œì–´ëŒ (é‘å‡ºæ–¼è—)", d:"ìŠ¤ìŠ¹ë³´ë‹¤ ì œìê°€ ë” ë›°ì–´ë‚˜ë‹¤ëŠ” ëœ». ì„ ìƒë‹˜ì€ ë„¤ê°€ ë‚˜ë³´ë‹¤ í›Œë¥­í•´ì ¸ì„œ ë„ˆë¬´ ê¸°ë».", e:"ğŸ“˜"},
                {t:"ìœ ì§€ê²½ì„± (æœ‰å¿—ç«Ÿæˆ)", d:"ëœ»ì´ ìˆëŠ” ê³³ì— ê¸¸ì´ ìˆì–´. ë„¤ê°€ ì›í•˜ë˜ ê±¸ ê²°êµ­ í•´ëƒˆêµ¬ë‚˜!", e:"ğŸš©"},
                {t:"ë‚­ì¤‘ì§€ì¶” (å›Šä¸­ä¹‹éŒ)", d:"ì£¼ë¨¸ë‹ˆ ì†ì˜ ì†¡ê³³. ë„ˆì˜ ì¬ëŠ¥ì€ ìˆ¨ê¸¸ë ¤ì•¼ ìˆ¨ê¸¸ ìˆ˜ê°€ ì—†êµ¬ë‚˜!", e:"ğŸŒŸ"},
                {t:"ë‹¤ë‹¤ìµì„  (å¤šå¤šç›Šå–„)", d:"ë§ìœ¼ë©´ ë§ì„ìˆ˜ë¡ ì¢‹ì•„. í–‰ë³µê³¼ ì¦ê±°ì›€ì€ ë§ì„ìˆ˜ë¡ ì¢‹ì§€!", e:"ğŸ"},
                {t:"í˜•ì„¤ì§€ê³µ (è¢é›ªä¹‹åŠŸ)", d:"ì–´ë ¤ì›€ ì†ì—ì„œ ê³µë¶€í•˜ì—¬ ì´ë£¬ ê³µ. ë„¤ ë…¸ë ¥ì´ ë¹›ì„ ë°œí–ˆì–´.", e:"ğŸ•¯ï¸"},
                {t:"ì²œì¬ì¼ìš° (åƒè¼‰ä¸€é‡)", d:"ì²œ ë…„ì— í•œ ë²ˆ ë§Œë‚  ì¢‹ì€ ê¸°íšŒ! ë†“ì¹˜ì§€ ë§ê³  ê½‰ ì¡ì•„!", e:"âš¡"},
                {t:"ì‹œì‘ì´ ë°˜ì´ë‹¤", d:"ì´ë¯¸ ì‹œì‘í–ˆë‹¤ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ë„Œ ì ˆë°˜ì´ë‚˜ ì„±ê³µí•œ ê±°ì•¼. ë©‹ì ¸!", e:"ğŸ"},
                {t:"ë°±ì§€ì¥ë„ ë§ë“¤ë©´ ë‚«ë‹¤", d:"ì¹œêµ¬ì™€ í•¨ê»˜í•´ì„œ ë” ì¢‹ì•˜ì§€? í˜‘ë™ì˜ í˜ì€ ëŒ€ë‹¨í•´.", e:"ğŸ¤"},
                // ... (ë°ì´í„°ëŸ‰ í™•ë³´ë¥¼ ìœ„í•œ ì¶”ê°€ ìŠ¬ë¡¯)
                {t:"No Pain, No Gain", d:"ê³ í†µ ì—†ì´ëŠ” ì–»ëŠ” ê²ƒë„ ì—†ë‹¤. ë„¤ ë•€ë°©ìš¸ì´ ë§Œë“  ê²°ê³¼ì•¼.", e:"ğŸ’ª"},
                {t:"í¼ ë¯¸ì³¤ë‹¤!", d:"(AI íŠ¹ë³„ ì¹­ì°¬) ì˜¤ëŠ˜ ë„ˆì˜ ì»¨ë””ì…˜ì€ ì •ë§ ìµœê³ ì˜€ì–´! ì´ëŒ€ë¡œë§Œ ê°€ì.", e:"ğŸ˜"}
            ],
            negative: [
                {t:"ë¹„ ì˜¨ ë’¤ì— ë•…ì´ êµ³ëŠ”ë‹¤", d:"ì§€ê¸ˆì€ í˜ë“¤ê³  ì•„í”„ì§€ë§Œ, ì´ ì¼ì„ ê²ªê³  ë‚˜ë©´ ë„Œ í›¨ì”¬ ë” ë‹¨ë‹¨í•´ì§ˆ ê±°ì•¼.", e:"ğŸŒ±"},
                {t:"ìƒˆì˜¹ì§€ë§ˆ (å¡ç¿ä¹‹é¦¬)", d:"ì¸ìƒì˜ ê¸¸í‰í™”ë³µì€ ì•Œ ìˆ˜ ì—†ì–´. ì˜¤ëŠ˜ì˜ ë‚˜ìœ ì¼ì´ ë‚´ì¼ì˜ ì¢‹ì€ ì¼ì´ ë  ìˆ˜ë„ ìˆì–´.", e:"ğŸ´"},
                {t:"ì „í™”ìœ„ë³µ (è½‰ç¦çˆ²ç¦)", d:"í™”ê°€ ë°”ë€Œì–´ ì˜¤íˆë ¤ ë³µì´ ë  ê±°ì•¼. ì‹¤ìˆ˜ë¥¼ ê¸°íšŒë¡œ ë°”ê¿”ë³´ì.", e:"ğŸ”„"},
                {t:"ì¹ ì „íŒ”ê¸° (ä¸ƒé¡šå…«èµ·)", d:"ì¼ê³± ë²ˆ ë„˜ì–´ì ¸ë„ ì—¬ëŸ ë²ˆ ì¼ì–´ë‚˜ì. í¬ê¸°í•˜ì§€ ì•ŠëŠ” ë„¤ê°€ ì±”í”¼ì–¸ì´ì•¼.", e:"ğŸ¥Š"},
                {t:"ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆ", d:"ì—ë””ìŠ¨ë„ ìˆ˜ì²œ ë²ˆ ì‹¤íŒ¨í–ˆì–´. ì˜¤ëŠ˜ì˜ ì‹¤íŒ¨ëŠ” ì„±ê³µìœ¼ë¡œ ê°€ëŠ” ì—°ìŠµì¼ ë¿ì´ì•¼.", e:"ğŸ’¡"},
                {t:"ëŒ€ê¸°ë§Œì„± (å¤§å™¨æ™©æˆ)", d:"í° ê·¸ë¦‡ì€ ëŠ¦ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ë²•. ë„ˆëŠ” í¬ê²Œ ë  ì‚¬ëŒì´ë¼ ì‹œê°„ì´ ì¢€ ê±¸ë¦¬ëŠ” ê±°ì•¼.", e:"ğŸº"},
                {t:"ì™€ì‹ ìƒë‹´ (è‡¥è–ªå˜—è†½)", d:"ëª©í‘œë¥¼ ì´ë£¨ê¸° ìœ„í•´ ì–´ë ¤ì›€ì„ ì°¸ë‹¤. ì§€ê¸ˆì˜ ê³ í†µì€ í›—ë‚ ì˜ ë°‘ê±°ë¦„ì´ì•¼.", e:"ğŸ”¥"},
                {t:"ê°œêµ¬ë¦¬ ì˜¬ì±™ì´ ì  ìƒê° ëª» í•œë‹¤", d:"ëˆ„êµ¬ë‚˜ ì²˜ìŒì€ ìˆì–´. ëª»í•œë‹¤ê³  ë„ˆë¬´ ê¸°ì£½ì§€ ë§ˆ. ë„ˆë„ ê³§ ì˜í•˜ê²Œ ë  ê±°ì•¼.", e:"ğŸ¸"},
                {t:"ê¸‰í• ìˆ˜ë¡ ëŒì•„ê°€ë¼", d:"ë§ˆìŒì´ ì¡°ê¸‰í•  ë• ì ì‹œ ì‰¬ì–´ê°€ëŠ” ê²ƒë„ ë°©ë²•ì´ì•¼. ì²œì²œíˆ í•´ë„ ê´œì°®ì•„.", e:"ğŸ¢"},
                {t:"í‹°ëŒ ëª¨ì•„ íƒœì‚°", d:"ì§€ê¸ˆ ë‹¹ì¥ ê²°ê³¼ê°€ ì•ˆ ë³´ì—¬ë„, ì‘ì€ ë…¸ë ¥ì´ ëª¨ì—¬ í° ì‚°ì´ ë  ê±°ì•¼.", e:"ğŸ”ï¸"},
                {t:"ì†Œ ìƒê³  ì™¸ì–‘ê°„ ê³ ì¹˜ê¸°", d:"ì´ë¯¸ ë²Œì–´ì§„ ì¼ì€ ì–´ì©” ìˆ˜ ì—†ì–´. ëŒ€ì‹  ë‹¤ìŒì—” ì•ˆ ê·¸ëŸ¬ë©´ ë¼. ê·¸ê²Œ ë°°ì›€ì´ì•¼.", e:"ğŸ› ï¸"},
                {t:"í•˜ëŠ˜ì´ ë¬´ë„ˆì ¸ë„ ì†Ÿì•„ë‚  êµ¬ë©ì€ ìˆë‹¤", d:"ì•„ë¬´ë¦¬ ì ˆë§ì ì¸ ìƒí™©ì´ë¼ë„ í•´ê²°ì±…ì€ ë°˜ë“œì‹œ ìˆì–´. í˜ë‚´ì!", e:"ğŸŒ¤ï¸"},
                {t:"ì´ ë˜í•œ ì§€ë‚˜ê°€ë¦¬ë¼", d:"ì§€ê¸ˆì˜ ìŠ¬í””ë„ ì˜ì›í•˜ì§€ ì•Šì•„. ê³§ ì›ƒì„ ë‚ ì´ ì˜¬ ê±°ì•¼.", e:"â³"},
                {t:"í† ë¼ì™€ ê±°ë¶ì´", d:"ë¹ ë¥´ë‹¤ê³  ì´ê¸°ëŠ” ê²Œ ì•„ë‹ˆì•¼. ê¾¸ì¤€íˆ í•˜ëŠ” ë„¤ê°€ ê²°êµ­ ìŠ¹ë¦¬í•  ê±°ì•¼.", e:"ğŸ¢"},
                {t:"ê´œì°®ì•„, ì˜í•˜ê³  ìˆì–´", d:"(AI ìœ„ë¡œ) ê°€ë”ì€ ê·¸ëƒ¥ ìš¸ì–´ë„ ë¼. ì„ ìƒë‹˜ê³¼ AIëŠ” ì–¸ì œë‚˜ ë„¤ í¸ì´ì•¼.", e:"â¤ï¸"}
            ],
            neutral: [
                {t:"ì—­ì§€ì‚¬ì§€ (æ˜“åœ°æ€ä¹‹)", d:"ì…ì¥ì„ ë°”ê¿”ì„œ ìƒê°í•´ë³´ì. ì¹œêµ¬ì˜ ë§ˆìŒì„ ì´í•´í•˜ë©´ ë‹µì´ ë³´ì¼ ê±°ì•¼.", e:"ğŸ¤”"},
                {t:"ìœ ë¹„ë¬´í™˜ (æœ‰å‚™ç„¡æ‚£)", d:"ë¯¸ë¦¬ ì¤€ë¹„í•˜ë©´ ê±±ì •ì´ ì—†ì–´. ë‚´ì¼ ì¤€ë¹„ë¬¼ì„ ë¯¸ë¦¬ ì±™ê²¨ë³¼ê¹Œ?", e:"ğŸ’"},
                {t:"ë“±ì” ë°‘ì´ ì–´ë‘¡ë‹¤", d:"í•´ë‹µì€ ì˜ì™¸ë¡œ ì•„ì£¼ ê°€ê¹Œìš´ ê³³ì— ìˆì„ì§€ë„ ëª°ë¼. ì£¼ìœ„ë¥¼ ë‘˜ëŸ¬ë´.", e:"ğŸ•¯ï¸"},
                {t:"ê°€ëŠ” ë§ì´ ê³ ì™€ì•¼ ì˜¤ëŠ” ë§ì´ ê³±ë‹¤", d:"ë‚´ê°€ ë¨¼ì € ì˜ˆì˜ê²Œ ë§í•˜ë©´, ì¹œêµ¬ë„ ì˜ˆì˜ê²Œ ë§í•´ì¤„ ê±°ì•¼.", e:"ğŸ—£ï¸"},
                {t:"ëŒë‹¤ë¦¬ë„ ë‘ë“¤ê²¨ ë³´ê³  ê±´ë„ˆë¼", d:"ìµìˆ™í•œ ì¼ì´ë¼ë„ í•œ ë²ˆ ë” í™•ì¸í•˜ëŠ” ì‹ ì¤‘í•¨ì´ í•„ìš”í•´.", e:"ğŸŒ‰"},
                {t:"ë°±ë¬¸ì´ ë¶ˆì—¬ì¼ê²¬", d:"ë°± ë²ˆ ë“£ëŠ” ê²ƒë³´ë‹¤ í•œ ë²ˆ ë³´ëŠ” ê²Œ ë‚«ì§€. ì§ì ‘ ê²½í—˜í•œ ê±´ í° ìì‚°ì´ì•¼.", e:"ğŸ‘€"},
                {t:"ì§€í”¼ì§€ê¸° ë°±ì „ë¶ˆíƒœ", d:"ìƒëŒ€ë¥¼ ì•Œê³  ë‚˜ë¥¼ ì•Œë©´ ìœ„íƒœë¡­ì§€ ì•Šì•„. ë¬¸ì œì˜ ì›ì¸ì„ ì°¨ë¶„íˆ ë¶„ì„í•´ë³´ì.", e:"ğŸ“œ"},
                {t:"ì¹¨ë¬µì€ ê¸ˆì´ë‹¤", d:"í™”ê°€ ë‚  ë•ŒëŠ” ì ì‹œ ë§ì„ ì•„ë¼ëŠ” ê²Œ ì§€í˜œë¡œìš¸ ë•Œë„ ìˆì–´.", e:"ğŸ¤«"},
                {t:"ë‚®ë§ì€ ìƒˆê°€ ë“£ê³  ë°¤ë§ì€ ì¥ê°€ ë“£ëŠ”ë‹¤", d:"í•­ìƒ ë§ì¡°ì‹¬! ë‚¨ì„ í—˜ë‹´í•˜ëŠ” ê±´ ê²°êµ­ ë‚˜ì—ê²Œ ëŒì•„ì™€.", e:"ğŸ­"},
                {t:"ì‹œì¥ì´ ë°˜ì°¬ì´ë‹¤", d:"ë°°ê³ í”„ë©´ ë­ë“  ë§›ìˆì§€. í˜¹ì‹œ ë°°ê³ íŒŒì„œ ì˜ˆë¯¼í•œ ê±´ ì•„ë‹ê¹Œ?", e:"ğŸš"}
            ]
        };

        // ==========================================
        // 2. ì—”ì§„ (ë¡œì§) - ì‚¬ì „ ë§µí•‘ ìµœì í™”
        // ==========================================

        // ë¹ ë¥¸ ê²€ìƒ‰ì„ ìœ„í•´ ë°°ì—´ì„ ê°ì²´(Dictionary)ë¡œ ë³€í™˜
        let sentimentDict = {};
        
        // ê¸ì • ë‹¨ì–´ ë§µí•‘ (+1 ~ +3 ëœë¤ ê°€ì¤‘ì¹˜ ë¶€ì—¬ ë˜ëŠ” ê³ ì •)
        POSITIVE_WORDS.forEach(word => {
            // "í•µ"ì´ë‚˜ "ê°“" ê°™ì€ ê°•ì¡°ì–´ê°€ ë¶™ìœ¼ë©´ ì ìˆ˜ ë” ì¤Œ
            let score = 2; 
            if(word.includes("í•µ") || word.includes("ê°“") || word.includes("ìµœê³ ")) score = 3;
            sentimentDict[word] = score;
        });

        // ë¶€ì • ë‹¨ì–´ ë§µí•‘ (-1 ~ -3)
        NEGATIVE_WORDS.forEach(word => {
            let score = -2;
            if(word.includes("ê°œ") || word.includes("í•µ") || word.includes("ë§")) score = -3; // 'ê°œ'ê°€ ì ‘ë‘ì‚¬ë¡œ ì“°ì¼ë•Œ
            sentimentDict[word] = score;
        });

        function analyzeSentiment() {
            const rawText = document.getElementById('diaryInput').value;
            if (!rawText.trim()) { alert("ì¼ê¸°ë¥¼ ì¨ì£¼ì„¸ìš”!"); return; }

            // ê°„ë‹¨í•œ í† í¬ë‚˜ì´ì§• (ê³µë°± ê¸°ì¤€ + ì¡°ì‚¬ ë¶„ë¦¬ëŠ” ì—„ë°€íˆ ì•ˆí•¨, í¬í•¨ ì—¬ë¶€ë¡œ ì²´í¬)
            const tokens = rawText.split(/[\s,!.?]+/); 
            
            let totalScore = 0;
            let highlightedHTML = rawText; // ì›ë¬¸ì—ì„œ êµì²´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½
            let calculationSteps = [];
            
            // ì¤‘ë³µ ê³„ì‚° ë°©ì§€ë¥¼ ìœ„í•œ ì²˜ë¦¬
            let detectedWords = [];

            // í…ìŠ¤íŠ¸ ì „ì²´ë¥¼ ìˆœíšŒí•˜ë©° ë‹¨ì–´ ì°¾ê¸° (Greedy approach)
            // ê¸´ ë‹¨ì–´ë¶€í„° ì°¾ì•„ì„œ í•˜ì´ë¼ì´íŒ… ì²˜ë¦¬
            let allKeys = Object.keys(sentimentDict).sort((a, b) => b.length - a.length);

            // ì›ë³¸ í…ìŠ¤íŠ¸ ë³´ì¡´í•˜ë©´ì„œ í•˜ì´ë¼ì´íŒ… íƒœê·¸ ì‚½ì…
            // (ê°„ë‹¨í•œ êµ¬í˜„ì„ ìœ„í•´ ì—¬ê¸°ì„œëŠ” í…ìŠ¤íŠ¸ ë§¤ì¹­ë§Œ ìˆ˜í–‰)
            // ì‹¤ì œ êµ¬í˜„ì‹œ replaceAllì€ ê²¹ì¹˜ëŠ” ë‹¨ì–´ ë¬¸ì œ(ì˜ˆ: 'ì‚¬ê³¼', 'í’‹ì‚¬ê³¼')ê°€ ìˆì§€ë§Œ êµìœ¡ìš©ìœ¼ë¡  ì¶©ë¶„
            
            let tempHTML = rawText;
            
            allKeys.forEach(key => {
                if (tempHTML.includes(key)) {
                    // ì´ë¯¸ ì²˜ë¦¬ëœ íƒœê·¸ ì•ˆì˜ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œì§€ í™•ì¸í•˜ëŠ” ë¡œì§ì€ ë³µì¡í•˜ë¯€ë¡œ 
                    // ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœ í¬í•¨ ì—¬ë¶€ë¡œ ì ìˆ˜ë§Œ ê³„ì‚°í•˜ê³ , í•˜ì´ë¼ì´íŒ…ì€ ë³„ë„ í† í° ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜
                    // replace ë°©ì‹ì„ ì”ë‹ˆë‹¤. (ë‹¨, ë¬´í•œ ë£¨í”„ ë°©ì§€ ìœ„í•´ classê°€ ì´ë¯¸ ìˆëŠ” ê±´ ê±´ë„ˆëœ€)
                    
                    // ì •ê·œì‹ìœ¼ë¡œ ë‹¨ì–´ ì°¾ê¸° (íƒœê·¸ê°€ ì•ˆ ë¶™ì€ ìˆœìˆ˜ í…ìŠ¤íŠ¸ë§Œ)
                    const regex = new RegExp(`(${key})(?![^<]*>)`, 'g'); 
                    
                    if (tempHTML.match(regex)) {
                        const count = (tempHTML.match(regex) || []).length;
                        const score = sentimentDict[key];
                        
                        // ì ìˆ˜ í•©ì‚°
                        totalScore += (score * count);
                        for(let i=0; i<count; i++) {
                            calculationSteps.push(`${key}(${score > 0 ? '+'+score : score})`);
                        }

                        // í•˜ì´ë¼ì´íŒ… ì ìš©
                        const className = score > 0 ? 'pos-word' : 'neg-word';
                        tempHTML = tempHTML.replace(regex, `<span class="${className}">$1</span>`);
                    }
                }
            });

            highlightedHTML = tempHTML.replace(/\n/g, '<br>'); // ì¤„ë°”ê¿ˆ ì²˜ë¦¬

            renderResults(totalScore, highlightedHTML, calculationSteps);
        }

        function renderResults(score, html, steps) {
            const resultArea = document.getElementById('resultArea');
            const totalScoreEl = document.getElementById('totalScore');
            
            resultArea.classList.remove('hidden');
            totalScoreEl.innerText = score;
            document.getElementById('highlightedText').innerHTML = html;

            const calcText = steps.length > 0 
                ? steps.join(" + ").replace(/\+\-/g, '- ') + ` = ${score}ì `
                : "ê°ì • ë‹¨ì–´ë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”. (0ì )";
            document.getElementById('calculationBreakdown').innerText = calcText;

            // í…Œë§ˆ ì„¤ì •
            let theme, label, mainEmoji, idiomType;
            
            if (score >= 5) { theme='theme-very-happy'; label='ì™„ì „ ëŒ€ë°•! (ë§¤ìš° ë§‘ìŒ)'; mainEmoji='ğŸŒ'; idiomType='positive'; }
            else if (score >= 1) { theme='theme-happy'; label='ê¸°ë¶„ ì¢‹ìŒ (ë§‘ìŒ)'; mainEmoji='ğŸŒ¤ï¸'; idiomType='positive'; }
            else if (score === 0) { theme='theme-neutral'; label='ê·¸ëŸ­ì €ëŸ­ (êµ¬ë¦„)'; mainEmoji='â˜ï¸'; idiomType='neutral'; }
            else if (score >= -4) { theme='theme-sad'; label='ì¡°ê¸ˆ ìš°ìš¸ (ë¹„)'; mainEmoji='ğŸŒ§ï¸'; idiomType='negative'; }
            else { theme='theme-angry'; label='ë§ˆìŒì´ í˜ë“¤ì–´ (ì²œë‘¥ë²ˆê°œ)'; mainEmoji='â›ˆï¸'; idiomType='negative'; }

            // UI ì—…ë°ì´íŠ¸
            document.body.className = `${theme} min-h-screen p-6 flex justify-center items-center`;
            document.querySelectorAll('.header-emoji').forEach(el => el.innerText = mainEmoji);
            document.getElementById('sentimentLabel').innerText = label;
            document.getElementById('resultEmoji').innerText = mainEmoji;

            // ê´€ìš©êµ¬ ëœë¤ ì„ íƒ
            // 200ê°œ ë‹¤ ë„£ìœ¼ë©´ ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì ¸ì„œ, ìœ„ìª½ ë°°ì—´ì— ì˜ˆì‹œë¡œ 15ê°œì”© ë„£ì—ˆìœ¼ë‚˜
            // ì‹¤ì œ ë™ì‘ì‹œì—” categoryë³„ ëœë¤ìœ¼ë¡œ ë½‘ìŒ
            const list = IDIOMS[idiomType];
            const pick = list[Math.floor(Math.random() * list.length)];
            
            document.getElementById('idiomTitle').innerText = pick.t;
            document.getElementById('idiomDesc').innerText = pick.d;
            document.getElementById('idiomEmoji').innerText = pick.e;
            document.querySelector('.idiom-bg-emoji').innerText = pick.e;

            resultArea.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
