<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>AI ëª…íƒì •: êµ°ì¤‘ ì†ì˜ ë²”ì¸ ì°¾ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="../css/global.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: transparent;
            /* Use global background */
            --panel-light: rgba(236, 240, 241, 0.9);
            --highlight: #f1c40f;
            --criminal: #e74c3c;
            --citizen: #27ae60;
            --ui-blue: #3498db;
        }

        body {
            font-family: 'Do Hyeon', sans-serif;
            /* background-color: var(--bg-dark); Handled by global.css */
            color: #333;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- ìƒë‹¨ í—¤ë” --- */
        header {
            background: rgba(52, 73, 94, 0.8);
            backdrop-filter: blur(10px);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 40;
            /* Below nav (50) */
            margin-top: 0;
            /* Nav is fixed, but we might need spacing if we don't want overlap. Actually body has pt-20 */
        }

        h1 {
            margin: 0;
            font-family: 'Black Han Sans', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 2px;
        }

        .stats {
            font-size: 1.2rem;
        }

        .stats span {
            color: var(--highlight);
            margin-left: 5px;
        }

        /* --- ë©”ì¸ ë ˆì´ì•„ì›ƒ (ì¢Œìš° ë¶„í• ) --- */
        #game-area {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }

        /* ì™¼ìª½: í•™ìŠµì‹¤ (Interrogation Room) */
        #training-zone {
            width: 320px;
            background: rgba(189, 195, 199, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
            z-index: 5;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ìš©ì˜ì ì¹´ë“œ (SVG ì•„ë°”íƒ€) */
        .suspect-card {
            width: 220px;
            height: 250px;
            background: white;
            border: 5px solid #7f8c8d;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .suspect-card svg {
            width: 180px;
            height: 180px;
        }

        /* ì¡°ì‘ ë²„íŠ¼ */
        .btn-group {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-family: 'Do Hyeon', sans-serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            color: white;
        }

        button:active {
            transform: scale(0.95);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-thief {
            background: var(--criminal);
            box-shadow: 0 4px 0 #c0392b;
        }

        .btn-citizen {
            background: var(--citizen);
            box-shadow: 0 4px 0 #219150;
        }

        .btn-arrest {
            background: var(--ui-blue);
            box-shadow: 0 4px 0 #2980b9;
            width: 100%;
            margin-top: 20px;
            font-size: 1.5rem;
        }

        .btn-reset {
            background: #95a5a6;
            margin-top: auto;
            font-size: 1rem;
            padding: 10px;
        }

        /* AI ìƒê° ë¡œê·¸ */
        .ai-log {
            width: 100%;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 10px;
            font-size: 0.9rem;
            height: 150px;
            overflow-y: auto;
            margin-top: 10px;
            border: 2px solid #34495e;
        }

        .log-item {
            margin-bottom: 5px;
            border-bottom: 1px dashed #555;
            padding-bottom: 2px;
        }

        .feature-high {
            color: var(--criminal);
            font-weight: bold;
        }

        .feature-low {
            color: var(--citizen);
        }

        /* ì˜¤ë¥¸ìª½: ë„ì‹œ ê´‘ì¥ (Crowd) */
        #city-square {
            flex: 1;
            background: rgba(236, 240, 241, 0.8);
            backdrop-filter: blur(5px);
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            justify-content: center;
            gap: 8px;
            position: relative;
        }

        /* êµ°ì¤‘ ì† ë¯¸ë‹ˆ ì•„ë°”íƒ€ */
        .mini-person {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .mini-person svg {
            width: 30px;
            height: 30px;
        }

        .mini-person:hover {
            transform: scale(1.5);
            z-index: 100;
            border-color: var(--ui-blue);
        }

        /* ì²´í¬ëœ ìƒíƒœ */
        .mini-person.arrested {
            background-color: var(--criminal);
            border-color: #c0392b;
            transform: scale(1.1);
            animation: shake 0.5s;
        }

        .mini-person.arrested::after {
            content: "ğŸ”’";
            position: absolute;
            font-size: 20px;
            top: -10px;
            right: -10px;
            z-index: 101;
        }

        /* ë¬´ê³ í•œ ì‹œë¯¼ ì²´í¬ (ì˜¤íŒ) ì‹œê°ì  íš¨ê³¼ - ë‚˜ì¤‘ì— í™•ì¸ìš© */
        .mini-person.wrong-arrest {
            box-shadow: 0 0 10px red;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        /* íŒ ëª¨ë‹¬ */
        .tooltip {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 1rem;
            max-width: 300px;
            line-height: 1.4;
            pointer-events: none;
            opacity: 0.8;
        }
    </style>
</head>

<body class="pt-20">

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <header>
        <div style="display:flex; align-items:center; gap:10px;">
            <span style="font-size:2rem;">ğŸ•µï¸â€â™€ï¸</span>
            <div>
                <h1>AI ëª…íƒì •</h1>
                <span style="font-size:0.8rem; opacity:0.8;">ë¹…ë°ì´í„° ë¶„ì„ì‹¤</span>
            </div>
        </div>
        <div class="stats">
            ì´ ì¸êµ¬: <span id="total-pop">500</span>ëª… |
            í•™ìŠµ íšŸìˆ˜: <span id="train-count">0</span>íšŒ |
            ì²´í¬ëœ ì‚¬ëŒ: <span id="arrest-count">0</span>ëª…
        </div>
    </header>

    <div id="game-area">
        <div id="training-zone">
            <h2 style="margin-top:0;">1. ë²”ì¸ í•™ìŠµì‹œí‚¤ê¸°</h2>
            <p style="font-size:0.9rem; text-align:center; margin-bottom:10px;">
                ì´ ì‚¬ëŒì„ ë³´ê³  íŒë‹¨í•´ì£¼ì„¸ìš”.<br>
                <span style="color:#7f8c8d;">(ì„ ìƒë‹˜ì´ ì •í•œ ë²”ì¸ì˜ íŠ¹ì§•ì€?)</span>
            </p>

            <div class="suspect-card" id="current-suspect-view">
            </div>

            <div class="btn-group">
                <button class="btn-thief" onclick="teachAI('thief')">ë²”ì¸ì´ë‹¤! ğŸ˜¡</button>
                <button class="btn-citizen" onclick="teachAI('citizen')">ì‹œë¯¼ì´ë‹¤ ğŸ˜‡</button>
            </div>

            <div class="ai-log" id="ai-brain-log">
                <div style="text-align:center; color:#bdc3c7;">ì•„ì§ í•™ìŠµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>

            <button class="btn-arrest" onclick="arrestPhase()">ğŸš¨ ì „ì› ì²´í¬ ì‹œì‘!</button>
            <button class="btn-reset" onclick="resetGame()">ğŸ”„ ê²Œì„ ì´ˆê¸°í™”</button>
        </div>

        <div id="city-square">
        </div>

        <div class="tooltip">
            ğŸ’¡ <b>íŒ:</b> "íŒŒë€ ì…”ì¸ " ì…ì€ ì‚¬ëŒë§Œ ê³„ì† ë²”ì¸ìœ¼ë¡œ ì§€ëª©í•´ë³´ì„¸ìš”.
            AIê°€ ë‚˜ì¤‘ì— íŒŒë€ ì˜· ì…ì€ ì‚¬ëŒì€ ë¬´ì¡°ê±´ ì¡ì•„ë“¤ì´ëŠ” <b>'í¸í–¥(Bias)'</b>ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
    </div>

    <script src="../js/nav.js"></script>
    <script>
        /* --- 1. ì„¤ì • ë° ë°ì´í„° --- */
        const TOTAL_PEOPLE = 500;
        const FEATURES = {
            skinColor: ['#f1c27d', '#e0ac69', '#8d5524', '#ffdbac'],
            shirtColor: ['#e74c3c', '#3498db', '#f1c40f', '#2ecc71', '#9b59b6', '#34495e', '#ecf0f1'],
            hairColor: ['#2c3e50', '#8e44ad', '#e67e22', '#f1c40f', '#ecf0f1'],
            hat: [true, false],
            glasses: [true, false],
            mask: [true, false],
            beard: [true, false],
            mustache: [true, false],
            tie: [true, false],
            scar: [true, false],
            hairStyle: ['short', 'long', 'bald', 'spiky']
        };

        let people = []; // 500ëª… ë°ì´í„°
        let currentSuspect = null; // í˜„ì¬ í•™ìŠµ ì¤‘ì¸ ì‚¬ëŒ
        let weights = {}; // AIì˜ í•™ìŠµ ê°€ì¤‘ì¹˜ (Feature Weights)
        let trainCount = 0;

        /* --- 2. ì´ˆê¸°í™” ë° ìƒì„± ë¡œì§ --- */
        function initGame() {
            people = [];
            weights = {};
            trainCount = 0;
            document.getElementById('city-square').innerHTML = '';
            document.getElementById('ai-brain-log').innerHTML = '<div style="text-align:center; color:#bdc3c7;">ì•„ì§ í•™ìŠµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            updateStats();

            // 500ëª… ìƒì„±
            for (let i = 0; i < TOTAL_PEOPLE; i++) {
                people.push(generateRandomPerson(i));
            }

            // í™”ë©´ì— ë Œë”ë§ (Batch ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”)
            const fragment = document.createDocumentFragment();
            people.forEach(p => {
                const el = document.createElement('div');
                el.className = 'mini-person';
                el.id = `person-${p.id}`;
                el.innerHTML = getAvatarSVG(p);
                el.onclick = () => { showSuspectInPanel(p); }; // í´ë¦­í•˜ë©´ í•™ìŠµ íŒ¨ë„ë¡œ ì´ë™
                fragment.appendChild(el);
            });
            document.getElementById('city-square').appendChild(fragment);

            // ì²« ë²ˆì§¸ í•™ìŠµ ëŒ€ìƒ ì„ ì •
            pickNewSuspect();
        }

        function generateRandomPerson(id) {
            // ëœë¤ ì†ì„± ë¶€ì—¬
            return {
                id: id,
                skinColor: randomPick(FEATURES.skinColor),
                shirtColor: randomPick(FEATURES.shirtColor),
                hairColor: randomPick(FEATURES.hairColor),
                hat: Math.random() < 0.3, // 30% í™•ë¥ 
                glasses: Math.random() < 0.3,
                mask: Math.random() < 0.2,
                beard: Math.random() < 0.2,
                mustache: Math.random() < 0.2,
                tie: Math.random() < 0.3,
                scar: Math.random() < 0.1,
                hairStyle: randomPick(FEATURES.hairStyle)
            };
        }

        function randomPick(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /* --- 3. SVG ì•„ë°”íƒ€ ìƒì„±ê¸° (í•µì‹¬ ì‹œê°í™”) --- */
        function getAvatarSVG(p) {
            // ì–¼êµ´
            let svg = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">`;

            // ëª¸í†µ (ì…”ì¸ )
            svg += `<rect x="20" y="70" width="60" height="30" rx="10" fill="${p.shirtColor}" />`;
            if (p.tie) svg += `<path d="M50 70 L50 90 L45 95 L50 100 L55 95 L50 90" fill="#333" stroke="white" stroke-width="1"/>`;

            // ë¨¸ë¦¬ (í”¼ë¶€)
            svg += `<circle cx="50" cy="50" r="25" fill="${p.skinColor}" />`;

            // í‰í„°
            if (p.scar) svg += `<path d="M40 45 L45 55" stroke="#a94442" stroke-width="2" />`;

            // ë¨¸ë¦¬ì¹´ë½
            if (p.hairStyle !== 'bald' && !p.hat) {
                if (p.hairStyle === 'short') svg += `<path d="M25 50 Q50 20 75 50" fill="${p.hairColor}" />`;
                if (p.hairStyle === 'long') svg += `<path d="M25 50 Q50 10 75 50 L75 80 L25 80 Z" fill="${p.hairColor}" />`;
                if (p.hairStyle === 'spiky') svg += `<path d="M25 50 L35 30 L45 50 L50 25 L55 50 L65 30 L75 50 Z" fill="${p.hairColor}" />`;
            }

            // ëˆˆ
            svg += `<circle cx="40" cy="50" r="3" fill="black" />`;
            svg += `<circle cx="60" cy="50" r="3" fill="black" />`;

            // ìˆ˜ì—¼
            if (p.beard) svg += `<path d="M30 60 Q50 80 70 60" fill="none" stroke="${p.hairColor}" stroke-width="3" />`;
            if (p.mustache) svg += `<rect x="35" y="55" width="30" height="3" rx="1" fill="${p.hairColor}" />`;

            // ì•ˆê²½
            if (p.glasses) {
                svg += `<circle cx="40" cy="50" r="8" fill="none" stroke="black" stroke-width="2" />`;
                svg += `<circle cx="60" cy="50" r="8" fill="none" stroke="black" stroke-width="2" />`;
                svg += `<line x1="48" y1="50" x2="52" y2="50" stroke="black" stroke-width="2" />`;
            }

            // ë§ˆìŠ¤í¬
            if (p.mask) svg += `<rect x="30" y="55" width="40" height="20" rx="5" fill="white" stroke="#ccc" />`;

            // ëª¨ì (ê°€ì¥ ìœ„ì— ê·¸ë ¤ì•¼ í•¨)
            if (p.hat) {
                svg += `<rect x="20" y="35" width="60" height="10" fill="#333" />`;
                svg += `<rect x="30" y="15" width="40" height="20" fill="#333" />`;
            }

            svg += `</svg>`;
            return svg;
        }

        /* --- 4. í•™ìŠµ ë¡œì§ (AI Brain) --- */
        function pickNewSuspect() {
            // êµ°ì¤‘ ì¤‘ì—ì„œ ëœë¤í•˜ê²Œ í•œ ëª…ì„ ë°ë ¤ì˜´
            currentSuspect = people[Math.floor(Math.random() * TOTAL_PEOPLE)];
            showSuspectInPanel(currentSuspect);
        }

        function showSuspectInPanel(p) {
            currentSuspect = p;
            const view = document.getElementById('current-suspect-view');
            view.innerHTML = getAvatarSVG(p);
        }

        function teachAI(label) {
            trainCount++;

            // ê°€ì¤‘ì¹˜ ì—…ë°ì´íŠ¸ (ì§€ë„ í•™ìŠµ)
            // ë²”ì¸ì´ë©´ íŠ¹ì§• ì ìˆ˜ +1, ì‹œë¯¼ì´ë©´ íŠ¹ì§• ì ìˆ˜ -1
            const delta = (label === 'thief') ? 1 : -1;

            updateWeight('hat', currentSuspect.hat, delta);
            updateWeight('glasses', currentSuspect.glasses, delta);
            updateWeight('mask', currentSuspect.mask, delta);
            updateWeight('beard', currentSuspect.beard, delta);
            updateWeight('mustache', currentSuspect.mustache, delta);
            updateWeight('tie', currentSuspect.tie, delta);
            updateWeight('shirt_' + currentSuspect.shirtColor, true, delta); // ìƒ‰ìƒì€ ë³„ë„ ì²˜ë¦¬

            updateStats();
            updateLog();
            pickNewSuspect(); // ë‹¤ìŒ ì‚¬ëŒ ë°ë ¤ì˜¤ê¸°

            // ì‹œê°ì  í”¼ë“œë°±
            const view = document.getElementById('current-suspect-view');
            view.style.transform = label === 'thief' ? 'rotate(10deg)' : 'rotate(-10deg)';
            setTimeout(() => view.style.transform = 'rotate(0deg)', 200);
        }

        function updateWeight(feature, isActive, delta) {
            if (!isActive) return; // íŠ¹ì§•ì´ ì—†ìœ¼ë©´ í•™ìŠµ ì•ˆí•¨
            if (!weights[feature]) weights[feature] = 0;
            weights[feature] += delta;
        }

        function updateLog() {
            // ê°€ì¤‘ì¹˜ê°€ ë†’ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬í•´ì„œ ë³´ì—¬ì¤Œ (AIê°€ ë¬´ì—‡ì„ ë²”ì¸ì˜ íŠ¹ì§•ìœ¼ë¡œ ë³´ëŠ”ì§€)
            const sorted = Object.entries(weights).sort((a, b) => Math.abs(b[1]) - Math.abs(a[1]));

            let html = '';
            sorted.forEach(([key, val]) => {
                if (val === 0) return;
                const style = val > 0 ? 'feature-high' : 'feature-low';
                const text = translateFeature(key);
                const score = val > 0 ? `+${val} (ë²”ì¸ íŠ¹ì§•)` : `${val} (ì‹œë¯¼ íŠ¹ì§•)`;
                html += `<div class="log-item ${style}">${text}: ${score}</div>`;
            });

            if (html === '') html = '<div style="text-align:center; color:#bdc3c7;">íŠ¹ì§•ì„ ì°¾ëŠ” ì¤‘...</div>';
            document.getElementById('ai-brain-log').innerHTML = html;
        }

        function translateFeature(key) {
            if (key === 'hat') return 'ğŸ© ëª¨ì';
            if (key === 'glasses') return 'ğŸ‘“ ì•ˆê²½';
            if (key === 'mask') return 'ğŸ˜· ë§ˆìŠ¤í¬';
            if (key === 'beard') return 'ğŸ§” í„±ìˆ˜ì—¼';
            if (key === 'mustache') return 'ã€°ï¸ ì½§ìˆ˜ì—¼';
            if (key === 'tie') return 'ğŸ‘” ë„¥íƒ€ì´';
            if (key.includes('shirt')) return `ğŸ‘• ì˜· ìƒ‰ê¹”(${key.split('_')[1]})`;
            return key;
        }

        /* --- 5. ì‹¤ì „ ì²´í¬ (Inference) --- */
        function arrestPhase() {
            if (trainCount < 5) {
                alert("ë°ì´í„°ê°€ ë„ˆë¬´ ë¶€ì¡±í•©ë‹ˆë‹¤! ìµœì†Œ 5ëª…ì€ í•™ìŠµì‹œì¼œì£¼ì„¸ìš”.");
                return;
            }

            let arrestCount = 0;
            document.querySelectorAll('.mini-person').forEach(el => el.classList.remove('arrested'));

            people.forEach(p => {
                // ì ìˆ˜ ê³„ì‚° (Inference)
                let score = 0;
                if (p.hat) score += (weights['hat'] || 0);
                if (p.glasses) score += (weights['glasses'] || 0);
                if (p.mask) score += (weights['mask'] || 0);
                if (p.beard) score += (weights['beard'] || 0);
                if (p.mustache) score += (weights['mustache'] || 0);
                if (p.tie) score += (weights['tie'] || 0);
                score += (weights['shirt_' + p.shirtColor] || 0);

                // ì ìˆ˜ê°€ 0ë³´ë‹¤ í¬ë©´ ë²”ì¸ìœ¼ë¡œ íŒë‹¨
                if (score > 0) {
                    const el = document.getElementById(`person-${p.id}`);
                    setTimeout(() => {
                        el.classList.add('arrested');
                    }, Math.random() * 1000); // ì•½ê°„ì˜ ì‹œì°¨ë¥¼ ë‘ê³  ì²´í¬ (ì—°ì¶œ)
                    arrestCount++;
                }
            });

            document.getElementById('arrest-count').innerText = arrestCount;
            alert(`AI ë¶„ì„ ê²°ê³¼, ì´ ${arrestCount}ëª…ì„ ìš©ì˜ìë¡œ ì²´í¬í–ˆìŠµë‹ˆë‹¤!`);
        }

        function resetGame() {
            if (confirm("ëª¨ë“  í•™ìŠµ ë‚´ìš©ì„ ì§€ìš°ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                initGame();
            }
        }

        function updateStats() {
            document.getElementById('train-count').innerText = trainCount;
            document.getElementById('arrest-count').innerText = document.querySelectorAll('.arrested').length;
        }

        // ê²Œì„ ì‹œì‘
        window.onload = initGame;

    </script>
</body>

</html>