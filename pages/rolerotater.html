<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Fair Role - iOS Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="../css/global.css" rel="stylesheet">
    <style>
        /* --- iOS Design System (Previous Style Preserved) --- */
        :root {
            --ios-bg: transparent;
            /* Use global background */
            --ios-card: rgba(255, 255, 255, 0.8);
            /* Semi-transparent */
            --ios-blue: #007AFF;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
            --ios-green: #34C759;
            --ios-text: #1C1C1E;
            --ios-gray: #8E8E93;
            --ios-border: rgba(0, 0, 0, 0.1);
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
            /* background-color: var(--ios-bg); Handled by global.css */
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            color: var(--ios-text);
            overflow: hidden;
        }

        /* --- ì‚¬ì´ë“œë°” (ì„¤ì •) --- */
        #sidebar {
            width: 380px;
            background: rgba(242, 242, 247, 0.8);
            /* Semi-transparent iOS bg */
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 20;
            padding: 20px 0;
            overflow-y: auto;
        }

        .ios-header {
            padding: 0 20px 10px 20px;
        }

        .ios-header h1 {
            font-size: 24px;
            font-weight: 800;
            margin: 0;
        }

        .ios-header p {
            font-size: 13px;
            color: var(--ios-gray);
            margin: 4px 0 0 0;
        }

        .list-group {
            background: var(--ios-card);
            border-radius: 12px;
            margin: 0 16px 20px 16px;
            padding: 5px 16px;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--ios-border);
            font-size: 15px;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-label {
            font-weight: 600;
            color: #333;
        }

        /* ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        select,
        input[type="text"],
        input[type="number"] {
            border: none;
            background: transparent;
            font-size: 15px;
            text-align: right;
            outline: none;
            font-weight: 500;
            color: var(--ios-blue);
        }

        /* ì—­í•  ê´€ë¦¬ ë¦¬ìŠ¤íŠ¸ */
        .role-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .role-input {
            flex: 1;
            border: 1px solid var(--ios-border);
            padding: 8px;
            border-radius: 8px;
            font-size: 14px;
            background: rgba(250, 250, 250, 0.8);
            text-align: left !important;
            color: #333 !important;
        }

        .count-input {
            width: 40px;
            text-align: center !important;
            border: 1px solid var(--ios-border);
            padding: 8px;
            border-radius: 8px;
            background: rgba(250, 250, 250, 0.8);
        }

        /* ë‚œì´ë„ ë°°ì§€ ë²„íŠ¼ */
        .diff-btn {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }

        .diff-high {
            background: #ffebeb;
            color: var(--ios-red);
        }

        .diff-mid {
            background: #fff8e1;
            color: var(--ios-orange);
        }

        .diff-low {
            background: #e8f5e9;
            color: var(--ios-green);
        }

        /* ì‚­ì œ ë²„íŠ¼ */
        .del-btn {
            color: var(--ios-gray);
            cursor: pointer;
            padding: 5px;
        }

        .del-btn:hover {
            color: var(--ios-red);
        }

        /* ì¶”ê°€ ë²„íŠ¼ */
        .add-btn {
            width: 100%;
            padding: 10px;
            text-align: center;
            color: var(--ios-blue);
            font-weight: 600;
            cursor: pointer;
            border-top: 1px solid var(--ios-border);
            margin-top: 5px;
        }

        /* í•™ìƒ ë¦¬ìŠ¤íŠ¸ */
        .student-row {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--ios-border);
        }

        .student-num {
            width: 24px;
            font-size: 12px;
            font-weight: bold;
            color: var(--ios-gray);
        }

        .student-name {
            flex: 1;
            font-weight: 600;
        }

        .constraint-btn {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            cursor: pointer;
            background: rgba(242, 242, 247, 0.8);
            color: #ccc;
        }

        .constraint-btn.active {
            background: #ffebeb;
            color: var(--ios-red);
            font-weight: bold;
        }

        /* í•˜ë‹¨ ì‹¤í–‰ ë²„íŠ¼ */
        .bottom-action {
            padding: 16px;
            background: transparent;
            position: sticky;
            bottom: 0;
            /* backdrop-filter: blur(10px); handled by sidebar bg */
        }

        .ios-btn {
            width: 100%;
            background: linear-gradient(135deg, #34C759, #28a745);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
        }

        .ios-btn:active {
            transform: scale(0.98);
        }

        /* --- ë©”ì¸ í™”ë©´ (ê²°ê³¼ ë³´ë“œ) --- */
        #main-board {
            flex: 1;
            position: relative;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        /* ì—­í•  ì¹´ë“œ ê·¸ë¦¬ë“œ */
        #role-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .role-card {
            background: var(--ios-card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            border: 2px solid transparent;
            transition: transform 0.2s;
            backdrop-filter: blur(10px);
        }

        .role-card:hover {
            transform: translateY(-5px);
        }

        .role-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .role-title {
            font-size: 18px;
            font-weight: 800;
            color: #333;
        }

        .role-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 20px;
            font-weight: bold;
        }

        /* ë°°ì •ëœ í•™ìƒ íƒœê·¸ */
        .assigned-student {
            display: inline-block;
            background: rgba(240, 242, 245, 0.8);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin: 4px;
            border-left: 3px solid var(--ios-blue);
        }

        /* --- í•˜ë‹¨ ê³µì •ì„± ê·¸ë˜í”„ --- */
        #stats-section {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            margin-top: auto;
        }

        .stats-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #555;
        }

        .bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }

        .bar-label {
            width: 50px;
            font-size: 12px;
            font-weight: 600;
            text-align: right;
            margin-right: 10px;
            color: #eee;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .bar-track {
            flex: 1;
            height: 10px;
            background: rgba(224, 224, 224, 0.5);
            border-radius: 5px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: var(--ios-blue);
            width: 0%;
            transition: width 0.5s;
        }

        .bar-value {
            width: 30px;
            font-size: 11px;
            margin-left: 8px;
            color: #eee;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body class="pt-20">

    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>

    <div id="sidebar">
        <div class="ios-header">
            <h1>AI ì²­ì†Œ ë§¤ë‹ˆì €</h1>
            <p>ê³µì •í•¨ì˜ ëíŒì™•, ì—…ë¬´ ê°•ë„ ìë™ ì¡°ì ˆ</p>
        </div>

        <div class="list-group">
            <div class="list-item">
                <span class="list-label">í•™ìƒ ìˆ˜</span>
                <select id="student-count" onchange="initStudents()">
                </select>
            </div>
        </div>

        <div class="ios-header" style="padding-top:10px; padding-bottom:5px;">
            <span style="font-size:12px; color:var(--ios-gray); font-weight:600;">ì²­ì†Œ êµ¬ì—­ ë° ì—­í•  ì„¤ì •</span>
        </div>
        <div class="list-group" id="role-list-container" style="padding:10px;">
        </div>

        <div class="ios-header" style="padding-bottom:5px;">
            <span style="font-size:12px; color:var(--ios-gray); font-weight:600;">í•™ìƒ ëª…ë‹¨ & ì œì•½ ì¡°ê±´</span>
        </div>
        <div class="list-group" id="student-list-container">
        </div>

        <div class="bottom-action">
            <button class="ios-btn" onclick="runAssignment()">
                âœ¨ ê³µì •í•˜ê²Œ ë°°ì •í•˜ê¸°
            </button>
        </div>
    </div>

    <div id="main-board">

        <div>
            <h2 style="margin:0 0 15px 0; color:white; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">ğŸ“¢ ì´ë²ˆ ì£¼ ì—­í•  ë°°ì •í‘œ</h2>
            <div id="role-grid">
                <div style="grid-column: 1/-1; text-align: center; color: #ccc; padding: 40px;">
                    ì™¼ìª½ì˜ 'ë°°ì •í•˜ê¸°' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>

        <div id="stats-section">
            <div class="stats-title">ğŸ“Š ëˆ„ì  ì—…ë¬´ ê°•ë„ (Fairness Check)</div>
            <div id="stats-chart">
            </div>
        </div>

    </div>

    <script src="../js/nav.js"></script>
    <script>
        // --- ì „ì—­ ë³€ìˆ˜ ---
        let roles = [
            { id: 1, name: 'êµì‹¤ ì“¸ê¸°', difficulty: 3, count: 2 }, // ë‚œì´ë„ 3(ìƒ)
            { id: 2, name: 'ì¹ íŒ ë‹¦ê¸°', difficulty: 2, count: 1 }, // ë‚œì´ë„ 2(ì¤‘)
            { id: 3, name: 'ìš°ìœ  ë‹¹ë²ˆ', difficulty: 2, count: 2 },
            { id: 4, name: 'ì±…ìƒ ì¤„ë§ì¶”ê¸°', difficulty: 1, count: 2 }, // ë‚œì´ë„ 1(í•˜)
            { id: 5, name: 'ë³µë„ ì²­ì†Œ', difficulty: 3, count: 2 },
            { id: 6, name: '1ì¸ 1ì—­(íœ´ì‹)', difficulty: 0, count: 99 } // ë‚¨ëŠ” ì¸ì›ìš©
        ];

        // í•™ìƒ ë°ì´í„° (ëˆ„ì  ì ìˆ˜ í¬í•¨)
        let students = [];

        // ëœë¤ ì´ë¦„
        const nameDB = ['ë¯¼ì¤€', 'ì„œì¤€', 'ë„ìœ¤', 'ì˜ˆì¤€', 'ì‹œìš°', 'í•˜ì¤€', 'ì§€í˜¸', 'ì§€ìš°', 'ì„œí˜„', 'ì„œì—°', 'ì§€ìœ ', 'ì§€ì•„', 'ìˆ˜ì•„', 'ì†Œì€', 'ìœ ì§„'];
        function getRandomName() { return nameDB[Math.floor(Math.random() * nameDB.length)]; }

        // --- ì´ˆê¸°í™” ---
        window.onload = function () {
            // í•™ìƒ ìˆ˜ ë“œë¡­ë°•ìŠ¤
            const sel = document.getElementById('student-count');
            for (let i = 1; i <= 40; i++) {
                let opt = document.createElement('option');
                opt.value = i; opt.text = i + "ëª…";
                if (i === 12) opt.selected = true;
                sel.appendChild(opt);
            }

            renderRoleList();
            initStudents();
        };

        // --- 1. ì—­í• (Role) ê´€ë¦¬ ë¡œì§ ---
        function renderRoleList() {
            const container = document.getElementById('role-list-container');
            container.innerHTML = '';

            roles.forEach((role, idx) => {
                // íœ´ì‹ ì—­í• ì€ ìˆ˜ì • ë¶ˆê°€ë¡œ ìˆ¨ê¸°ê±°ë‚˜ ê³ ì •
                if (role.difficulty === 0) return;

                const div = document.createElement('div');
                div.className = 'role-row';

                // ë‚œì´ë„ í´ë˜ìŠ¤
                let diffClass = role.difficulty === 3 ? 'diff-high' : (role.difficulty === 2 ? 'diff-mid' : 'diff-low');
                let diffText = role.difficulty === 3 ? 'ìƒ' : (role.difficulty === 2 ? 'ì¤‘' : 'í•˜');

                div.innerHTML = `
                    <input type="text" class="role-input" value="${role.name}" onchange="updateRole(${idx}, 'name', this.value)">
                    <input type="number" class="count-input" value="${role.count}" min="1" onchange="updateRole(${idx}, 'count', this.value)">
                    <div class="diff-btn ${diffClass}" onclick="toggleDiff(${idx})">${diffText}</div>
                    <div class="del-btn" onclick="deleteRole(${idx})">âœ–</div>
                `;
                container.appendChild(div);
            });

            // ì¶”ê°€ ë²„íŠ¼
            const addBtn = document.createElement('div');
            addBtn.className = 'add-btn';
            addBtn.innerText = '+ ìƒˆ ì—­í•  ì¶”ê°€';
            addBtn.onclick = addRole;
            container.appendChild(addBtn);
        }

        function updateRole(idx, field, val) {
            if (field === 'count') val = parseInt(val);
            roles[idx][field] = val;
        }

        function toggleDiff(idx) {
            roles[idx].difficulty = roles[idx].difficulty >= 3 ? 1 : roles[idx].difficulty + 1;
            renderRoleList();
        }

        function deleteRole(idx) {
            if (confirm('ì´ ì—­í• ì„ ì‚­ì œí• ê¹Œìš”?')) {
                roles.splice(idx, 1);
                renderRoleList();
            }
        }

        function addRole() {
            roles.splice(roles.length - 1, 0, { id: Date.now(), name: 'ìƒˆ êµ¬ì—­', difficulty: 1, count: 1 });
            renderRoleList();
        }

        // --- 2. í•™ìƒ ê´€ë¦¬ ë¡œì§ ---
        function initStudents() {
            const count = parseInt(document.getElementById('student-count').value);
            const container = document.getElementById('student-list-container');

            // ê¸°ì¡´ ë°ì´í„° ìœ ì§€í•˜ë©´ì„œ ë¦¬ì‚¬ì´ì§•
            let newStudents = [];
            for (let i = 0; i < count; i++) {
                if (i < students.length) {
                    newStudents.push(students[i]);
                } else {
                    newStudents.push({
                        id: i,
                        name: getRandomName(),
                        score: Math.floor(Math.random() * 10), // ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•´ ëœë¤ ì´ˆê¸° ì ìˆ˜ ë¶€ì—¬
                        injured: false
                    });
                }
            }
            students = newStudents;
            renderStudentList();
        }

        function renderStudentList() {
            const container = document.getElementById('student-list-container');
            container.innerHTML = '';

            students.forEach((stu, idx) => {
                const div = document.createElement('div');
                div.className = 'student-row';

                let injuredClass = stu.injured ? 'active' : '';
                let injuredText = stu.injured ? 'ğŸš‘ ë¶€ìƒ/ì œì™¸' : 'ğŸ’ª ê±´ê°•í•¨';

                div.innerHTML = `
                    <span class="student-num">${idx + 1}</span>
                    <input type="text" class="student-input student-name" style="text-align:left;" value="${stu.name}" onchange="students[${idx}].name=this.value">
                    <div class="constraint-btn ${injuredClass}" onclick="toggleInjured(${idx})">${injuredText}</div>
                `;
                container.appendChild(div);
            });
        }

        function toggleInjured(idx) {
            students[idx].injured = !students[idx].injured;
            renderStudentList();
        }

        // --- 3. AI ë°°ì • ì•Œê³ ë¦¬ì¦˜ (í•µì‹¬) ---
        function runAssignment() {
            // 1. ì—­í•  í’€(Slot) ë§Œë“¤ê¸°
            let slots = [];
            roles.forEach(role => {
                if (role.difficulty > 0) { // ì¼ë°˜ ì—­í• 
                    for (let i = 0; i < role.count; i++) slots.push({ ...role }); // ë³µì‚¬í•´ì„œ ë„£ê¸°
                }
            });

            // 2. í•™ìƒ ìˆ˜ê°€ ì—­í•  ìˆ˜ë³´ë‹¤ ë§ìœ¼ë©´ ë‚˜ë¨¸ì§€ëŠ” 'íœ´ì‹(1ì¸1ì—­)'ìœ¼ë¡œ ì±„ì›€
            while (slots.length < students.length) {
                slots.push({ name: '1ì¸ 1ì—­(íœ´ì‹)', difficulty: 0, id: 999 });
            }
            // í•™ìƒ ìˆ˜ê°€ ë” ì ìœ¼ë©´ ìŠ¬ë¡¯ì„ ì¤„ì„ (ëœë¤í•˜ê²Œ ë’¤ì—ì„œ ìë¦„ - ì‹¤ì œë¡  ì¤‘ìš” ì—­í• ë¶€í„° ì±„ì›Œì•¼ê² ì§€ë§Œ ë‹¨ìˆœí™”)
            if (slots.length > students.length) {
                slots = slots.slice(0, students.length);
            }

            // 3. ì•Œê³ ë¦¬ì¦˜: ëˆ„ì  ì ìˆ˜ê°€ ë‚®ì€ í•™ìƒì—ê²Œ í˜ë“  ì¼ì„ ì¤˜ì•¼ í•¨ (Fairness)
            // í•™ìƒì„ 'ëˆ„ì  ì ìˆ˜ ì˜¤ë¦„ì°¨ìˆœ'ìœ¼ë¡œ ì •ë ¬ (ì ìˆ˜ ë‚®ì€ ì• ê°€ ì•)
            // ë‹¨, ë§¤ë²ˆ ë˜‘ê°™ìœ¼ë©´ ì•ˆë˜ë‹ˆê¹Œ ì•½ê°„ì˜ ëœë¤ì„±(Noise) ì¶”ê°€
            let sortedStudents = [...students].sort((a, b) => {
                return (a.score + Math.random() * 2) - (b.score + Math.random() * 2);
            });

            // ìŠ¬ë¡¯ì„ 'ë‚œì´ë„ ë‚´ë¦¼ì°¨ìˆœ'ìœ¼ë¡œ ì •ë ¬ (í˜ë“  ì¼ì´ ì•)
            slots.sort((a, b) => b.difficulty - a.difficulty);

            // 4. ë§¤ì¹­ (Greedy) & ì œì•½ ì¡°ê±´ ì²´í¬
            let assignments = []; // { student, role }

            // í˜ë“  ì¼(ë‚œì´ë„ 3)ë¶€í„° ë°°ì •í•˜ëŠ”ë°, ë¶€ìƒìëŠ” ê±´ë„ˆëœ€
            // ì´ ë¡œì§ì€ ë³µì¡í•˜ë¯€ë¡œ, ë‹¨ìˆœí™”ëœ íˆ¬ íŒ¨ìŠ¤(Two-pass) ë°©ì‹ ì‚¬ìš©

            // Pass 1: ë¶€ìƒìë“¤ì€ ë‚œì´ë„ 3ì—ì„œ ì œì™¸í•˜ê³  ì˜ˆì•½
            // Pass 2: ë‚˜ë¨¸ì§€ í•™ìƒë“¤ë¡œ í˜ë“  ì¼ë¶€í„° ì±„ì›€

            let finalSlots = new Array(students.length).fill(null);
            let unassignedStudents = [...sortedStudents]; // ë³µì‚¬ë³¸

            // ìŠ¬ë¡¯ ìˆœíšŒ (í˜ë“ ê±° -> ì‰¬ìš´ê±°)
            for (let i = 0; i < slots.length; i++) {
                let role = slots[i];

                // ì´ ì—­í• ì„ ìˆ˜í–‰í•  ìµœê³ ì˜ í›„ë³´ ì°¾ê¸°
                let candidateIndex = -1;

                // ì•ì—ì„œë¶€í„°(ì ìˆ˜ ë‚®ì€ì• ë¶€í„°) ì°¾ë˜ ì œì•½ì¡°ê±´ í™•ì¸
                for (let j = 0; j < unassignedStudents.length; j++) {
                    let stu = unassignedStudents[j];

                    // ì œì•½: ë¶€ìƒìëŠ” ë‚œì´ë„ 3 ë¶ˆê°€
                    if (stu.injured && role.difficulty >= 3) continue;

                    candidateIndex = j;
                    break;
                }

                // ë§Œì•½ ì í•©ìê°€ ì—†ìœ¼ë©´(ì „ì› ë¶€ìƒì ë“±) ê·¸ëƒ¥ ì•„ë¬´ë‚˜(ë§¨ ì•) ì‹œí‚´
                if (candidateIndex === -1) candidateIndex = 0;

                let selectedStudent = unassignedStudents.splice(candidateIndex, 1)[0];

                // ê²°ê³¼ ì €ì¥
                assignments.push({
                    studentId: selectedStudent.id,
                    studentName: selectedStudent.name,
                    roleName: role.name,
                    roleDiff: role.difficulty
                });

                // ì ìˆ˜ ì—…ë°ì´íŠ¸ (ì‹œë®¬ë ˆì´ì…˜)
                let originalStu = students.find(s => s.id === selectedStudent.id);
                originalStu.score += role.difficulty;
            }

            renderResults(assignments);
            renderStats();
        }

        // --- 4. ê²°ê³¼ ë Œë”ë§ ---
        function renderResults(assignments) {
            const grid = document.getElementById('role-grid');
            grid.innerHTML = '';

            // ì—­í• ë³„ë¡œ ê·¸ë£¹í™”
            let grouped = {};
            // ë¨¼ì € ëª¨ë“  ì—­í•  í‚¤ ìƒì„± (ìˆœì„œ ìœ ì§€ ìœ„í•´)
            roles.forEach(r => grouped[r.name] = { ...r, students: [] });

            assignments.forEach(a => {
                if (grouped[a.roleName]) {
                    grouped[a.roleName].students.push(a.studentName);
                }
            });

            // ì¹´ë“œ ìƒì„±
            for (let key in grouped) {
                let item = grouped[key];
                // ë°°ì •ëœ í•™ìƒì´ ì—†ì–´ë„ ì¹´ë“œëŠ” ë³´ì—¬ì¤Œ (ì„¤ì •ëœ ì—­í• ì´ë‹ˆê¹Œ)

                const card = document.createElement('div');
                card.className = 'role-card';

                // ë‚œì´ë„ ë°°ì§€
                let badgeClass = item.difficulty === 3 ? 'diff-high' : (item.difficulty === 2 ? 'diff-mid' : 'diff-low');
                let badgeText = item.difficulty === 3 ? 'ğŸ”¥ í˜ë“¦(ìƒ)' : (item.difficulty === 2 ? 'ğŸ’§ ë³´í†µ(ì¤‘)' : 'ğŸŒ± ì‰¬ì›€(í•˜)');
                if (item.difficulty === 0) { badgeClass = 'diff-low'; badgeText = 'ğŸ’¤ íœ´ì‹'; }

                // í…Œë‘ë¦¬ ìƒ‰ìƒ (ë‚œì´ë„ë³„)
                if (item.difficulty === 3) card.style.borderColor = '#ffcccc';
                if (item.difficulty === 1) card.style.borderColor = '#e8f5e9';

                let studentsHtml = item.students.map(name => `<span class="assigned-student">${name}</span>`).join('');
                if (item.students.length === 0) studentsHtml = '<span style="color:#ccc; font-size:13px;">ë°°ì • ì¸ì› ì—†ìŒ</span>';

                card.innerHTML = `
                    <div class="role-header">
                        <span class="role-title">${item.name}</span>
                        <span class="role-badge ${badgeClass}">${badgeText}</span>
                    </div>
                    <div>${studentsHtml}</div>
                `;
                grid.appendChild(card);
            }
        }

        function renderStats() {
            const chart = document.getElementById('stats-chart');
            chart.innerHTML = '';

            // ì ìˆ˜ ìµœëŒ€ê°’ ì°¾ê¸° (ê·¸ë˜í”„ ë¹„ìœ¨ìš©)
            let maxScore = Math.max(...students.map(s => s.score)) || 1;

            students.forEach(stu => {
                const row = document.createElement('div');
                row.className = 'bar-container';

                let width = (stu.score / maxScore) * 100;
                let color = width > 80 ? '#FF3B30' : (width < 30 ? '#34C759' : '#007AFF');

                row.innerHTML = `
                    <div class="bar-label">${stu.name}</div>
                    <div class="bar-track">
                        <div class="bar-fill" style="width: ${width}%; background: ${color};"></div>
                    </div>
                    <div class="bar-value">${stu.score}</div>
                `;
                chart.appendChild(row);
            });
        }
    </script>
</body>

</html>